<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#10b981">
<title>ORGANIZE TIMES</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0f172a;color:#fff;min-height:100vh}

/* TELAS */
.tela{display:none;min-height:100vh;padding-bottom:80px}
.tela.ativa{display:block}

/* LOGIN */
.tela-login{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px 20px;background:linear-gradient(160deg,#0f172a 0%,#1e293b 50%,#0f172a)}
.logo-wrap{text-align:center;margin-bottom:36px}
.logo-ball{font-size:68px;display:block;animation:bounce 2s infinite;margin-bottom:8px}
.logo-nome{font-size:50px;font-weight:900;letter-spacing:-2px;background:linear-gradient(135deg,#10b981,#34d399);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo-tag{color:#64748b;font-size:14px;margin-top:6px}
.card-login{background:rgba(30,41,59,0.85);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.08);border-radius:24px;padding:34px 28px;width:100%;max-width:440px;box-shadow:0 24px 60px rgba(0,0,0,0.5)}
.card-login h2{font-size:24px;margin-bottom:5px}
.card-login>p{color:#94a3b8;font-size:14px;margin-bottom:22px}

/* FORMS */
.fg{margin-bottom:15px}
.fg label{display:block;font-size:12px;font-weight:600;color:#cbd5e1;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px}
.fg input,.fg select,.fg textarea{width:100%;padding:12px 14px;background:rgba(15,23,42,0.7);border:2px solid rgba(148,163,184,0.2);border-radius:12px;color:#fff;font-size:15px;transition:border-color 0.2s}
.fg input:focus,.fg select:focus,.fg textarea:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.15)}
.fg input::placeholder,.fg textarea::placeholder{color:#475569}
.fg select option{background:#1e293b;color:#fff}
.fg textarea{min-height:70px;resize:vertical}

/* BOT√ïES */
.btn{width:100%;padding:14px;border:none;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;background:linear-gradient(135deg,#10b981,#059669);color:#fff;margin-top:8px;box-shadow:0 4px 14px rgba(16,185,129,0.35);transition:transform 0.15s;display:flex;align-items:center;justify-content:center;gap:8px}
.btn:active{transform:scale(0.96)}
.btn-sec{background:transparent;border:2px solid rgba(148,163,184,0.25);box-shadow:none;color:#94a3b8}
.btn-sec:hover{border-color:#10b981;color:#10b981}
.btn-sm{width:auto;padding:9px 18px;font-size:13px;margin:0}
.btn-red{background:linear-gradient(135deg,#ef4444,#dc2626);box-shadow:0 4px 14px rgba(239,68,68,0.35)}
.btn-gold{background:linear-gradient(135deg,#f59e0b,#d97706);box-shadow:0 4px 16px rgba(245,158,11,0.4)}
.btn-purple{background:linear-gradient(135deg,#8b5cf6,#7c3aed);box-shadow:0 4px 16px rgba(139,92,246,0.4)}

/* HEADER */
.hdr{padding:16px 20px;background:rgba(30,41,59,0.92);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,0.07);position:sticky;top:0;z-index:50}
.hdr h1{font-size:21px;background:linear-gradient(135deg,#10b981,#34d399);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hdr p{color:#94a3b8;font-size:13px;margin-top:2px}

/* CONTAINER */
.ctn{padding:16px;max-width:700px;margin:0 auto}

/* ACTION GRID */
.action-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px}
.action-card{background:rgba(30,41,59,0.8);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:20px 14px;cursor:pointer;transition:transform 0.2s,border-color 0.2s;text-align:center;position:relative}
.action-card:hover{transform:translateY(-3px);border-color:rgba(16,185,129,0.4)}
.action-card .ac-icon{font-size:32px;display:block;margin-bottom:7px}
.action-card h3{font-size:14px;margin-bottom:3px;color:#fff}
.action-card p{font-size:11px;color:#64748b}
.ac-badge{display:inline-block;margin-top:6px;padding:3px 10px;background:rgba(16,185,129,0.15);color:#10b981;border-radius:10px;font-size:10px;font-weight:700}
.ac-badge.gold{background:rgba(245,158,11,0.15);color:#f59e0b}
.ac-badge.purple{background:rgba(139,92,246,0.18);color:#a78bfa}
.action-card.locked{opacity:0.5}
.action-card.locked:hover{transform:none}
.lock-ico{font-size:13px;margin-left:3px}

/* SE√á√ÉO */
.sec{background:rgba(30,41,59,0.7);border:1px solid rgba(255,255,255,0.07);border-radius:16px;padding:18px;margin-bottom:14px}
.sec h2{font-size:16px;margin-bottom:12px;color:#fff;display:flex;align-items:center;gap:7px}

/* ITEM */
.item{background:rgba(15,23,42,0.6);border:1px solid rgba(148,163,184,0.1);border-radius:14px;padding:14px;margin-bottom:8px;cursor:pointer;transition:border-color 0.2s,transform 0.15s}
.item:hover{border-color:rgba(16,185,129,0.3);transform:translateX(3px)}
.item-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:5px}
.item-title{font-weight:700;font-size:15px}
.item-meta{font-size:12px;color:#94a3b8;line-height:1.7}

/* BADGES */
.badge{padding:3px 10px;border-radius:10px;font-size:11px;font-weight:600}
.badge-grn{background:rgba(16,185,129,0.2);color:#10b981}
.badge-blu{background:rgba(59,130,246,0.2);color:#60a5fa}
.badge-gry{background:rgba(148,163,184,0.15);color:#94a3b8}
.badge-ylw{background:rgba(234,179,8,0.2);color:#facc15}
.badge-gold{background:rgba(245,158,11,0.2);color:#f59e0b}
.badge-purple{background:rgba(139,92,246,0.22);color:#a78bfa}
.badge-red{background:rgba(239,68,68,0.2);color:#f87171}

/* ONLINE DOT */
.online-dot{width:9px;height:9px;background:#10b981;border-radius:50%;display:inline-block;animation:pulse 1.6s infinite;margin-right:5px}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* USER ROW */
.user-row{display:flex;align-items:center;gap:10px;background:rgba(15,23,42,0.5);border-radius:12px;padding:10px 12px;margin-bottom:7px;border:1px solid rgba(148,163,184,0.08)}
.user-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#10b981,#059669);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;flex-shrink:0}
.av-gold{background:linear-gradient(135deg,#f59e0b,#d97706)!important}
.av-purple{background:linear-gradient(135deg,#8b5cf6,#7c3aed)!important}
.user-row-info{flex:1;min-width:0}
.user-row-name{font-weight:600;font-size:14px}
.user-row-sub{font-size:11px;color:#64748b}

/* CRON√îMETRO */
.crono-box{background:linear-gradient(135deg,#1e293b,#0f172a);border:1px solid rgba(16,185,129,0.2);border-radius:20px;padding:26px 16px;text-align:center;margin-bottom:16px}
.crono-time{font-size:58px;font-weight:800;font-family:'Courier New',monospace;color:#fff;margin:8px 0;text-shadow:0 0 20px rgba(16,185,129,0.4)}
.placar-row{display:flex;justify-content:center;gap:24px;margin:14px 0}
.placar-side{text-align:center}
.placar-label{font-size:11px;color:#94a3b8;margin-bottom:4px;text-transform:uppercase;letter-spacing:1px}
.placar-num{font-size:48px;font-weight:800;color:#fff}
.btn-gol{width:auto;padding:9px 18px;font-size:13px;margin:5px 0 0}
.btn-gol-menos{
  width:auto;
  padding:9px 18px;
  font-size:13px;
  margin:5px 0 0;
  background:rgba(239,68,68,0.15);
  border:1px solid rgba(239,68,68,0.3);
  color:#f87171;
}
.btn-gol-menos:hover{
  background:rgba(239,68,68,0.25);
  border-color:rgba(239,68,68,0.5);
}
.btn-gol-menos:active{
  transform:scale(0.95);
}
.crono-btns{display:flex;gap:8px;margin-top:16px}
.crono-btns .btn{flex:1}

/* CONTROLE DE TEMPO */
.tempo-controle{
  background:rgba(245,158,11,0.1);
  border:2px solid rgba(245,158,11,0.3);
  border-radius:12px;
  padding:14px;
  margin:14px 0;
  animation:slideDown 0.3s ease;
}
@keyframes slideDown{
  from{opacity:0;transform:translateY(-10px)}
  to{opacity:1;transform:translateY(0)}
}
.tc-header{
  text-align:center;
  font-weight:700;
  font-size:13px;
  color:#fbbf24;
  margin-bottom:10px;
  letter-spacing:0.5px;
}
.tc-btns{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:6px;
  margin-bottom:8px;
}
.tc-btn{
  padding:10px 8px;
  background:rgba(245,158,11,0.15);
  border:1px solid rgba(245,158,11,0.3);
  border-radius:8px;
  color:#fbbf24;
  font-size:12px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s;
  white-space:nowrap;
}
.tc-btn:hover{
  background:rgba(245,158,11,0.25);
  border-color:rgba(245,158,11,0.5);
}
.tc-btn:active{
  transform:scale(0.95);
}
.tc-btn.tc-reset{
  background:rgba(239,68,68,0.15);
  border-color:rgba(239,68,68,0.3);
  color:#f87171;
}
.tc-btn.tc-reset:hover{
  background:rgba(239,68,68,0.25);
  border-color:rgba(239,68,68,0.5);
}
.tc-info{
  text-align:center;
  font-size:10px;
  color:#94a3b8;
  font-style:italic;
}
@media(max-width:500px){
  .tc-btns{grid-template-columns:repeat(3,1fr)}
  .tc-btn.tc-reset{grid-column:1/-1}
}
.crono-regra{color:#64748b;font-size:12px;margin-top:10px}

/* BANNER PUBLICIT√ÅRIO */
.banner-pub{
  background:linear-gradient(90deg,#10b981,#059669);
  border-radius:16px;
  margin:16px 0;
  padding:0;
  overflow:hidden;
  box-shadow:0 4px 16px rgba(10,185,129,0.3);
  position:relative;
  animation:bannerSlide 0.5s ease;
}
@keyframes bannerSlide{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}
.banner-pub::before{
  content:'';
  position:absolute;
  top:0;left:0;right:0;
  height:50%;
  background:linear-gradient(180deg,rgba(255,255,255,0.2),transparent);
  pointer-events:none;
}
.banner-conteudo{
  display:flex;
  align-items:center;
  gap:14px;
  padding:16px 18px;
  position:relative;
}
.banner-icon{
  font-size:48px;
  flex-shrink:0;
  filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3));
  animation:iconBounce 2s ease-in-out infinite;
}
@keyframes iconBounce{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-6px)}
}
.banner-texto{
  flex:1;
}
.banner-titulo{
  font-size:16px;
  font-weight:800;
  color:#000;
  text-transform:uppercase;
  letter-spacing:0.5px;
  margin-bottom:4px;
  text-shadow:1px 1px 0 rgba(255,255,255,0.3);
}
.banner-desc{
  font-size:13px;
  color:rgba(0,0,0,0.75);
  font-weight:600;
}
.banner-btn{
  padding:11px 22px;
  background:#000;
  color:#10b981;
  border:none;
  border-radius:10px;
  font-weight:800;
  font-size:13px;
  cursor:pointer;
  white-space:nowrap;
  box-shadow:0 4px 12px rgba(0,0,0,0.4);
  transition:all 0.2s;
  letter-spacing:0.5px;
}
.banner-btn:hover{
  transform:scale(1.05);
  box-shadow:0 6px 16px rgba(0,0,0,0.5);
}
.banner-btn:active{
  transform:scale(0.95);
}
@media(max-width:600px){
  .banner-conteudo{
    flex-wrap:wrap;
    justify-content:center;
    text-align:center;
  }
  .banner-icon{font-size:40px}
  .banner-btn{width:100%;margin-top:8px}
}

/* ESCOLHA DE MODALIDADE */
.modalidades-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:12px;
  margin-top:20px;
}
.modal-card{
  background:linear-gradient(135deg,rgba(16,185,129,0.1),rgba(16,185,129,0.05));
  border:2px solid rgba(16,185,129,0.3);
  border-radius:16px;
  padding:24px 16px;
  text-align:center;
  cursor:pointer;
  transition:all 0.3s;
}
.modal-card:hover{
  transform:translateY(-4px);
  border-color:#10b981;
  background:linear-gradient(135deg,rgba(16,185,129,0.2),rgba(16,185,129,0.1));
  box-shadow:0 8px 24px rgba(16,185,129,0.3);
}
.modal-card:active{
  transform:translateY(0);
}
.modal-icon{
  font-size:48px;
  margin-bottom:12px;
  filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3));
}
.modal-nome{
  font-size:15px;
  font-weight:700;
  color:#fff;
  margin-bottom:4px;
}
.modal-desc{
  font-size:12px;
  color:#94a3b8;
  font-weight:600;
}
@media(max-width:500px){
  .modalidades-grid{
    grid-template-columns:repeat(2,1fr);
  }
}

/* BOT√ÉO VOLTAR */
.btn-back{
  position:absolute;
  left:16px;
  top:16px;
  background:rgba(100,116,139,0.15);
  border:1px solid rgba(100,116,139,0.3);
  color:#94a3b8;
  padding:8px 14px;
  border-radius:8px;
  font-size:13px;
  font-weight:600;
  cursor:pointer;
  transition:all 0.2s;
}
.btn-back:hover{
  background:rgba(100,116,139,0.25);
  border-color:rgba(100,116,139,0.5);
  color:#cbd5e1;
}
.btn-back:active{
  transform:scale(0.95);
}

/* PAINEL DE ADMIN */
.admin-stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:12px;
  margin-bottom:20px;
}
.admin-stat-card{
  background:linear-gradient(135deg,rgba(59,130,246,0.1),rgba(59,130,246,0.05));
  border:2px solid rgba(59,130,246,0.3);
  border-radius:14px;
  padding:20px 16px;
  text-align:center;
}

/* P√ÅGINAS INTERNAS */
.estatisticas .stat-item{text-align:center}
.estatisticas .stat-num{font-size:24px;font-weight:800;color:#10b981;margin-bottom:4px}
.estatisticas .stat-label{font-size:11px;color:#94a3b8;text-transform:uppercase;font-weight:600}
.rodada-card-pagina{
  background:rgba(30,41,59,0.9);
  border:3px solid rgba(16,185,129,0.4);
  border-radius:16px;
  padding:24px;
  margin-bottom:20px;
  transition:all 0.3s;
}
.rodada-card-pagina:hover{
  transform:translateY(-4px);
  border-color:#10b981;
  box-shadow:0 12px 40px rgba(16,185,129,0.3);
}
.podio-box{
  display:flex;
  justify-content:center;
  align-items:flex-end;
  gap:20px;
  margin-bottom:30px;
  flex-wrap:wrap;
}
.podio-item{
  text-align:center;
  transition:all 0.3s;
}
.podio-item:hover{transform:scale(1.05)}
.podio-medal{
  font-size:48px;
  margin-bottom:12px;
  animation:float 3s ease-in-out infinite;
}
@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-8px)}
}
.podio-base{
  background:linear-gradient(135deg,rgba(30,41,59,0.9),rgba(15,23,42,0.9));
  border:3px solid;
  border-radius:12px;
  padding:20px 16px;
  min-width:140px;
}
.primeiro .podio-base{border-color:#fbbf24;height:180px;box-shadow:0 8px 24px rgba(251,191,36,0.3)}
.segundo .podio-base{border-color:#94a3b8;height:150px;box-shadow:0 8px 24px rgba(148,163,184,0.2)}
.terceiro .podio-base{border-color:#fb923c;height:140px;box-shadow:0 8px 24px rgba(251,146,60,0.2)}
.podio-time{font-size:16px;font-weight:800;margin-bottom:6px}
.primeiro .podio-time{color:#fbbf24}
.segundo .podio-time{color:#cbd5e1}
.terceiro .podio-time{color:#fb923c}
.podio-stats{font-size:12px;color:#94a3b8;margin-bottom:4px}
.podio-tempo{font-size:18px;font-weight:700;color:#6ee7b7;margin-top:6px}
.vencedor-mvp-int{
  background:linear-gradient(135deg,rgba(245,158,11,0.2),rgba(245,158,11,0.1));
  border:3px solid #fbbf24;
  border-radius:16px;
  padding:32px;
  text-align:center;
  margin-bottom:24px;
}
.trofeu-int{font-size:64px;margin-bottom:12px;animation:float 3s ease-in-out infinite}
.vencedor-nome-int{font-size:28px;font-weight:800;color:#fbbf24;margin-bottom:8px;text-transform:uppercase}
.vencedor-votos-int{font-size:16px;color:#cbd5e1;font-weight:700}
.jogador-card-int{
  background:rgba(30,41,59,0.9);
  border:2px solid rgba(100,116,139,0.3);
  border-radius:12px;
  padding:16px;
  margin-bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  transition:all 0.3s;
}
.jogador-card-int:hover{
  border-color:#fbbf24;
  transform:translateX(6px);
  box-shadow:0 8px 24px rgba(251,191,36,0.2);
}
.jogador-card-int.selecionado-int{
  background:linear-gradient(135deg,rgba(245,158,11,0.2),rgba(245,158,11,0.1));
  border-color:#fbbf24;
  border-width:3px;
}
.jogador-avatar-int{
  width:50px;
  height:50px;
  background:linear-gradient(135deg,#10b981,#059669);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  font-weight:800;
  color:#000;
  box-shadow:0 4px 12px rgba(16,185,129,0.3);
}
.jogador-info-int{display:flex;align-items:center;gap:12px}
.jogador-nome-int{font-size:16px;font-weight:700;color:#cbd5e1;margin-bottom:4px}
.jogador-badge-int{
  background:rgba(100,116,139,0.3);
  padding:4px 10px;
  border-radius:6px;
  font-size:10px;
  color:#94a3b8;
  font-weight:600;
  text-transform:uppercase;
}
.votos-count-int{
  background:rgba(245,158,11,0.2);
  border:2px solid rgba(245,158,11,0.4);
  border-radius:10px;
  padding:10px 16px;
  text-align:center;
}
.votos-num-int{font-size:24px;font-weight:800;color:#fbbf24;line-height:1}
.votos-label-int{font-size:10px;color:#cbd5e1;text-transform:uppercase;font-weight:600}

.stat-icon{
  font-size:36px;
  margin-bottom:8px;
  filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}
.stat-numero{
  font-size:24px;
  font-weight:800;
  color:#60a5fa;
  margin-bottom:4px;
  font-family:'Courier New',monospace;
}
.stat-label{
  font-size:11px;
  color:#94a3b8;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.admin-actions{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:10px;
}
@media(max-width:600px){
  .admin-stats{
    grid-template-columns:repeat(2,1fr);
  }
  .admin-actions{
    grid-template-columns:1fr;
  }
}


/* TABELA */
.tabela{width:100%;border-collapse:collapse;margin-top:8px}
.tabela th{background:rgba(16,185,129,0.12);color:#10b981;padding:9px 6px;font-size:11px;font-weight:600;border-bottom:2px solid rgba(16,185,129,0.2);text-align:center;white-space:nowrap}
.tabela th:first-child{text-align:left;padding-left:10px}
.tabela td{padding:9px 6px;border-bottom:1px solid rgba(148,163,184,0.08);font-size:13px;text-align:center;color:#cbd5e1;white-space:nowrap}
.tabela td:first-child{text-align:left;padding-left:10px;font-weight:600;color:#fff}
.tabela tr:last-child td{border-bottom:none}
.pos-1{color:#facc15;font-weight:800}
.pos-2{color:#94a3b8;font-weight:700}
.pos-3{color:#cd7f32;font-weight:700}

/* VOTA√á√ÉO */
.voto-item{display:flex;align-items:center;justify-content:space-between;background:rgba(15,23,42,0.6);border:2px solid transparent;border-radius:14px;padding:12px 14px;margin-bottom:8px;cursor:pointer;transition:all 0.2s}
.voto-item:hover{border-color:rgba(16,185,129,0.3)}
.voto-item.sel{border-color:#10b981;background:rgba(16,185,129,0.1)}
.voto-item .vi-left{display:flex;align-items:center;gap:10px}
.voto-item .vi-name{font-weight:600;font-size:14px}
.voto-item .vi-sub{font-size:11px;color:#64748b}
.voto-check{font-size:20px;display:none}
.voto-item.sel .voto-check{display:block;color:#10b981}

/* ===== PLANOS ===== */
.planos-wrap{display:flex;flex-direction:column;gap:14px}
.plano-card{border-radius:18px;padding:22px 18px;position:relative;overflow:hidden}
.plano-card.free{background:rgba(30,41,59,0.75);border:1px solid rgba(255,255,255,0.1)}
.plano-card.iniciante{background:rgba(245,158,11,0.07);border:2px solid rgba(245,158,11,0.35)}
.plano-card.profissional{background:rgba(139,92,246,0.08);border:2px solid rgba(139,92,246,0.4)}
.plano-ribbon{position:absolute;top:12px;right:-24px;background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;font-size:10px;font-weight:800;padding:3px 30px;transform:rotate(45deg);letter-spacing:1px}
.plano-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px}
.plano-top h3{font-size:18px;color:#fff}
.plano-top .plano-sub{font-size:11px;color:#94a3b8;margin-top:2px}
.plano-price{font-size:26px;font-weight:800;margin-bottom:4px}
.plano-price span{font-size:13px;font-weight:500;color:#64748b}
.plano-trial{font-size:11px;color:#f59e0b;font-weight:600;margin-bottom:10px;padding:5px 10px;background:rgba(245,158,11,0.12);border-radius:8px;display:inline-block}
.plano-feats{list-style:none;margin:12px 0}
.plano-feats li{padding:5px 0;font-size:13px;color:#cbd5e1;border-bottom:1px solid rgba(148,163,184,0.06)}
.plano-feats li:last-child{border:none}
.feat-y{color:#10b981;margin-right:7px;font-weight:700}
.feat-n{color:#475569;margin-right:7px}
.plano-atual-tag{display:inline-block;padding:5px 12px;background:rgba(16,185,129,0.15);color:#10b981;border-radius:8px;font-size:12px;font-weight:700;margin-top:8px}

/* FILTROS */
.filtro-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
.filtro-btn{padding:6px 13px;border-radius:18px;border:1px solid rgba(148,163,184,0.2);background:rgba(15,23,42,0.5);color:#94a3b8;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s}
.filtro-btn:hover,.filtro-btn.ativo{border-color:#10b981;color:#10b981;background:rgba(16,185,129,0.1)}

/* TIME CARD */
.time-card{background:rgba(15,23,42,0.6);border:1px solid rgba(148,163,184,0.1);border-radius:14px;padding:14px;margin-bottom:8px;transition:border-color 0.2s}
.time-card:hover{border-color:rgba(16,185,129,0.25)}
.time-card-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.time-card-nome{font-weight:700;font-size:15px;display:flex;align-items:center;gap:7px}
.time-card-loc{font-size:11px;color:#64748b;line-height:1.8}
.time-jogadores{margin-top:8px;display:flex;flex-wrap:wrap;gap:5px}
.jog-tag{padding:3px 9px;border-radius:14px;font-size:11px;font-weight:600;background:rgba(16,185,129,0.12);color:#10b981;border:1px solid rgba(16,185,129,0.2)}
.jog-tag.pend{background:rgba(234,179,8,0.12);color:#facc15;border-color:rgba(234,179,8,0.2)}

/* GRUPO REGI√ÉO */
.grupo-titulo{font-size:12px;font-weight:700;color:#10b981;margin-bottom:8px;padding:6px 10px;background:rgba(16,185,129,0.1);border-radius:8px;display:flex;align-items:center;justify-content:space-between}

/* BOTTOM NAV */
.bnav{position:fixed;bottom:0;left:0;right:0;background:rgba(30,41,59,0.95);backdrop-filter:blur(12px);border-top:1px solid rgba(255,255,255,0.08);display:flex;padding:8px;z-index:100;box-shadow:0 -4px 20px rgba(0,0,0,0.3)}
.bnav-item{flex:1;text-align:center;padding:8px 4px;color:#64748b;cursor:pointer;border-radius:10px;transition:all 0.2s}
.bnav-item:active{transform:scale(0.92)}
.bnav-item.active{color:#10b981;background:rgba(16,185,129,0.12)}
.bnav-item .bi{font-size:20px;display:block;margin-bottom:2px}
.bnav-item .bl{font-size:10px;font-weight:600}

/* ALERTS */
.alert{padding:11px 14px;border-radius:12px;margin-bottom:12px;font-size:13px;font-weight:500;display:flex;align-items:center;gap:8px}
.alert-ok{background:rgba(16,185,129,0.18);color:#10b981;border:1px solid rgba(16,185,129,0.3)}
.alert-err{background:rgba(239,68,68,0.18);color:#ef4444;border:1px solid rgba(239,68,68,0.3)}
.alert-warn{background:rgba(245,158,11,0.15);color:#f59e0b;border:1px solid rgba(245,158,11,0.3)}
.alert a{color:inherit;text-decoration:underline;cursor:pointer;font-weight:700}

/* DIVIDER */
.divider{text-align:center;color:#475569;font-size:13px;margin:18px 0;position:relative}
.divider::before,.divider::after{content:'';position:absolute;top:50%;width:38%;height:1px;background:rgba(148,163,184,0.18)}
.divider::before{left:0}.divider::after{right:0}

/* ANIMA√á√ïES */
@keyframes fadeDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.anim-down{animation:fadeDown 0.6s ease}
.anim-up{animation:fadeUp 0.6s ease}

/* RESPONSIVO */
@media(max-width:480px){
  .logo-nome{font-size:38px}
  .card-login{padding:24px 16px}
  .crono-time{font-size:46px}
  .placar-num{font-size:40px}
  .plano-card{padding:18px 14px}
}
/* CHAT/MENSAGENS */
.conversa-item{
  background:rgba(30,41,59,0.6);
  border:2px solid rgba(100,116,139,0.3);
  border-radius:12px;
  padding:16px;
  margin-bottom:12px;
  cursor:pointer;
  transition:all 0.2s;
  display:flex;
  gap:12px;
  align-items:center;
  position:relative;
}
.conversa-item:hover{
  background:rgba(30,41,59,0.9);
  border-color:#10b981;
  transform:translateX(4px);
}
.conversa-item.nao-lida{
  border-color:#10b981;
  background:rgba(16,185,129,0.08);
}
.conversa-avatar{
  width:50px;
  height:50px;
  background:linear-gradient(135deg,#10b981,#059669);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  font-weight:800;
  color:#000;
  flex-shrink:0;
}
.conversa-info{
  flex:1;
  min-width:0;
}
.conversa-nome{
  font-size:16px;
  font-weight:700;
  color:#cbd5e1;
  margin-bottom:4px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.conversa-preview{
  font-size:14px;
  color:#94a3b8;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.conversa-item.nao-lida .conversa-preview{
  color:#10b981;
  font-weight:600;
}
.conversa-hora{
  font-size:12px;
  color:#64748b;
}
.conversa-badge{
  position:absolute;
  top:12px;
  right:12px;
  background:#10b981;
  color:#000;
  border-radius:10px;
  padding:2px 8px;
  font-size:11px;
  font-weight:800;
  min-width:20px;
  text-align:center;
}
.msg-bubble{
  max-width:70%;
  padding:12px 16px;
  border-radius:12px;
  margin-bottom:4px;
  word-wrap:break-word;
  position:relative;
}
.msg-enviada{
  align-self:flex-end;
  background:linear-gradient(135deg,#10b981,#059669);
  color:#000;
  border-bottom-right-radius:4px;
}
.msg-recebida{
  align-self:flex-start;
  background:rgba(30,41,59,0.9);
  color:#cbd5e1;
  border-bottom-left-radius:4px;
}
.msg-hora{
  font-size:10px;
  margin-top:4px;
  opacity:0.7;
  text-align:right;
}
.msg-enviada .msg-hora{
  color:#000;
}
.msg-recebida .msg-hora{
  color:#94a3b8;
}
.msg-status{
  font-size:11px;
  margin-left:4px;
}
.msg-convite{
  background:rgba(59,130,246,0.15);
  border:2px solid rgba(59,130,246,0.3);
  border-radius:12px;
  padding:16px;
  margin:8px 0;
  max-width:100%;
}
.msg-convite h4{
  color:#60a5fa;
  font-size:16px;
  margin-bottom:8px;
}
.msg-convite p{
  color:#94a3b8;
  font-size:14px;
  margin-bottom:12px;
}
.msg-convite-btns{
  display:flex;
  gap:8px;
}
.msg-convite-btns button{
  flex:1;
  padding:10px;
  border-radius:8px;
  border:none;
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s;
}
.btn-aceitar{
  background:linear-gradient(135deg,#10b981,#059669);
  color:#000;
}
.btn-recusar{
  background:rgba(239,68,68,0.2);
  color:#f87171;
}
.status-online{
  width:10px;
  height:10px;
  background:#10b981;
  border-radius:50%;
  display:inline-block;
  margin-right:4px;
  animation:pulse-dot 2s ease-in-out infinite;
}
@keyframes pulse-dot{
  0%,100%{opacity:1}
  50%{opacity:0.5}
}

</style>
</head>
<body>

<!-- ============ TELA LOGIN ============ -->
<div id="tela-login" class="tela-login anim-down">
  <div class="logo-wrap">
    <span class="logo-ball">‚öΩ</span>
    <div class="logo-nome">ORGANIZE TIMES</div>
    <div class="logo-tag">Organize jogos e eventos esportivos</div>
  </div>
  <div class="card-login anim-up">
    <div id="bloco-registro">
      <h2>Bem-vindo!</h2>
      <p>Crie sua conta gr√°tis e comece a se divertir ou organizar times</p>
      <div id="alert-login"></div>
      <form id="formRegistro" onsubmit="return false;">
        <div class="fg"><label>Nome Completo</label><input type="text" id="regNome" required placeholder="Ricardo Alexandre"></div>
        <div class="fg"><label>Data de Nascimento (opcional)</label><input type="text" id="regDataNasc" placeholder="09/10/1975" maxlength="10"></div>
        <div class="fg"><label>Telefone (opcional)</label><input type="text" id="regTel" placeholder="82999273198"></div>
        <div class="fg"><label>E-mail</label><input type="text" id="regEmail" required placeholder="rick.an75@gmail.com"></div>
        <div class="fg"><label>Senha</label><input type="password" id="regSenha" required placeholder="Sua senha"></div>
        <div class="fg"><label>Confirmar Senha</label><input type="password" id="regSenhaConf" required placeholder="Repita a senha"></div>
        <button type="button" class="btn" onclick="criarContaAgora()">üöÄ CRIAR CONTA GR√ÅTIS</button>
      </form>
      <div class="divider">ou</div>
      <button class="btn btn-sec" onclick="document.getElementById('bloco-registro').style.display='none';document.getElementById('bloco-login').style.display='block';document.getElementById('alert-login').innerHTML='';document.getElementById('alert-login2').innerHTML=''">J√° tenho conta</button>
    </div>
    <div id="bloco-login" style="display:none">
      <h2>Entrar</h2>
      <p>Coloque seus dados para acessar</p>
      <div id="alert-login2"></div>
      <form id="formLogin">
        <div class="fg"><label>E-mail</label><input type="email" id="logEmail" required placeholder="seu@email.com"></div>
        <div class="fg"><label>Senha</label><input type="password" id="logSenha" required placeholder="Sua senha"></div>
        <button type="submit" class="btn">üîê ENTRAR</button>
      </form>
      <div style="text-align:center;margin-top:12px">
        <button class="btn btn-sec btn-sm" onclick="mostrarRecuperarSenha()" style="width:auto;display:inline-flex">üîë Esqueci minha senha</button>
        <div style="margin-top:8px;opacity:0.3">
          <a onclick="acessarAdmin()" style="font-size:10px;color:#64748b;cursor:pointer;text-decoration:none">‚öôÔ∏è</a>
        </div>
      </div>
      <div class="divider">ou</div>
      <button class="btn btn-sec" onclick="document.getElementById('bloco-login').style.display='none';document.getElementById('bloco-registro').style.display='block';document.getElementById('alert-login').innerHTML='';document.getElementById('alert-login2').innerHTML=''">Criar conta</button>
      <div style="text-align:center;margin-top:12px;font-size:11px;color:#64748b">
        üí° Primeiro acesso? <span style="color:#10b981;cursor:pointer;text-decoration:underline" onclick="document.getElementById('bloco-login').style.display='none';document.getElementById('bloco-registro').style.display='block'">Crie sua conta gr√°tis</span>
      </div>
    </div>

    <!-- RECUPERAR SENHA -->
    <div id="bloco-recuperar" style="display:none">
      <h2>Recuperar Senha</h2>
      <p>Digite seu e-mail e telefone para redefinir</p>
      <div id="alert-recuperar"></div>
      <form id="formRecuperar">
        <div class="fg"><label>E-mail</label><input type="email" id="recEmail" required placeholder="seu@email.com"></div>
        <div class="fg"><label>Telefone</label><input type="tel" id="recTel" required placeholder="(82) 99999-9999"></div>
        <div class="fg" id="campoNovaSenha" style="display:none">
          <label>Nova Senha</label><input type="password" id="recNovaSenha" minlength="6" placeholder="M√≠nimo 6 caracteres">
        </div>
        <div class="fg" id="campoConfNovaSenha" style="display:none">
          <label>Confirmar Nova Senha</label><input type="password" id="recConfNovaSenha" minlength="6" placeholder="Digite novamente">
        </div>
        <button type="submit" class="btn" id="btnRecuperar">üîç VERIFICAR DADOS</button>
      </form>
      <div class="divider">ou</div>
      <button class="btn btn-sec" onclick="trocaBloco('login')">‚Üê Voltar para login</button>
    </div>
  </div>
</div>

<!-- ============ ESCOLHA DE MODALIDADE ============ -->
<div id="tela-modalidade" class="tela" style="display:none">
  <div class="hdr">
    <h1>‚öΩ Bem-vindo ao ORGANIZE TIMES!</h1>
    <p>Escolha sua modalidade favorita para come√ßar</p>
  </div>
  <div class="ctn">
    <div class="modalidades-grid">
      <div class="modal-card" onclick="escolherModalidade('campo')">
        <div class="modal-icon">‚öΩ</div>
        <div class="modal-nome">Futebol de Campo</div>
        <div class="modal-desc">11 vs 11</div>
      </div>
      
      <div class="modal-card" onclick="escolherModalidade('society')">
        <div class="modal-icon">ü•Ö</div>
        <div class="modal-nome">Society</div>
        <div class="modal-desc">7 vs 7</div>
      </div>
      
      <div class="modal-card" onclick="escolherModalidade('futsal')">
        <div class="modal-icon">üèüÔ∏è</div>
        <div class="modal-nome">Futsal / Sal√£o</div>
        <div class="modal-desc">5 vs 5</div>
      </div>
      
      <div class="modal-card" onclick="escolherModalidade('x1')">
        <div class="modal-icon">üë§</div>
        <div class="modal-nome">X1</div>
        <div class="modal-desc">1 vs 1</div>
      </div>
      
      <div class="modal-card" onclick="escolherModalidade('futevolei')">
        <div class="modal-icon">üèê</div>
        <div class="modal-nome">Futev√¥lei</div>
        <div class="modal-desc">2x2 ou 3x3</div>
      </div>
      
      <div class="modal-card" onclick="escolherModalidade('areia')">
        <div class="modal-icon">üèñÔ∏è</div>
        <div class="modal-nome">Futebol de Areia</div>
        <div class="modal-desc">5 vs 5</div>
      </div>
    </div>
    
    <button class="btn btn-sec" onclick="pularModalidade()" style="margin-top:20px">Pular por enquanto ‚Üí</button>
  </div>
</div>

<!-- ============ ADMIN ============ -->
<div id="tela-admin" class="tela" style="display:none">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1>‚öôÔ∏è Painel de Administrador</h1>
    <p>Controle total do sistema ORGANIZE TIMES</p>
  </div>
  <div class="ctn">
    
    <!-- ESTAT√çSTICAS GERAIS -->
    <div class="admin-stats">
      <div class="admin-stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-numero" id="adminTotalUsers">0</div>
        <div class="stat-label">Usu√°rios Totais</div>
      </div>
      <div class="admin-stat-card">
        <div class="stat-icon">üü¢</div>
        <div class="stat-numero" id="adminOnlineUsers">0</div>
        <div class="stat-label">Online Agora</div>
      </div>
      <div class="admin-stat-card">
        <div class="stat-icon">‚öΩ</div>
        <div class="stat-numero" id="adminTotalJogos">0</div>
        <div class="stat-label">Jogos Criados</div>
      </div>
      <div class="admin-stat-card">
        <div class="stat-icon">üéΩ</div>
        <div class="stat-numero" id="adminTotalTimes">0</div>
        <div class="stat-label">Times Cadastrados</div>
      </div>
      <div class="admin-stat-card">
        <div class="stat-icon">üíé</div>
        <div class="stat-numero" id="adminPagantes">0</div>
        <div class="stat-label">Usu√°rios Pagantes</div>
      </div>
      <div class="admin-stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-numero" id="adminReceita">R$ 0</div>
        <div class="stat-label">Receita Mensal</div>
      </div>
    </div>

    <!-- A√á√ïES R√ÅPIDAS -->
    <div class="sec">
      <h2>‚ö° A√ß√µes R√°pidas</h2>
      <div class="admin-actions">
        <button class="btn btn-gold" onclick="adminVerUsuarios()">üë• Ver Todos Usu√°rios</button>
        <button class="btn btn-gold" onclick="adminVerJogos()">‚öΩ Ver Todos Jogos</button>
        <button class="btn btn-gold" onclick="adminVerTimes()">üéΩ Ver Todos Times</button>
        <button class="btn btn-red" onclick="adminLimparDados()">üóëÔ∏è Limpar Todos Dados</button>
        <button class="btn" onclick="adminExportarDados()">üíæ Exportar Dados</button>
        <button class="btn" onclick="adminGerarRelatorio()">üìä Gerar Relat√≥rio</button>
      </div>
    </div>

    <!-- USU√ÅRIOS RECENTES -->
    <div class="sec">
      <h2>üÜï √öltimos Cadastros</h2>
      <div id="adminUltimosUsers"></div>
    </div>

    <!-- JOGOS ATIVOS -->
    <div class="sec">
      <h2>üéÆ Jogos Ativos</h2>
      <div id="adminJogosAtivos"></div>
    </div>

    <!-- FERRAMENTAS DE DESENVOLVIMENTO -->
    <div class="sec">
      <h2>üîß Ferramentas de Desenvolvimento</h2>
      <div class="admin-actions">
        <button class="btn btn-sec" onclick="adminCriarUsuarioTeste()">üë§ Criar Usu√°rio Teste</button>
        <button class="btn btn-sec" onclick="adminCriarJogoTeste()">‚öΩ Criar Jogo Teste</button>
        <button class="btn btn-sec" onclick="adminSimularTrafego()">üìà Simular Tr√°fego</button>
        <button class="btn btn-sec" onclick="adminVerConsole()">üñ•Ô∏è Ver Console</button>
      </div>
    </div>

  </div>
</div>

<!-- ============ DASHBOARD ============ -->
<div id="tela-dashboard" class="tela">
  <div class="hdr">
    <h1>‚öΩ ORGANIZE TIMES</h1>
    <p>Ol√°, <strong id="nomeUser">Jogador</strong> <span id="userBadge"></span> 
    <a onclick="acessarAdmin()" style="margin-left:8px;font-size:11px;opacity:0.3;cursor:pointer;text-decoration:none" title="Acesso Admin">‚öôÔ∏è</a></p>
  </div>
  <div class="ctn">
    <div id="alertDash"></div>
    <div class="action-grid">
      <div class="action-card" onclick="nav('mensagens')" style="position:relative">
        <span class="ac-icon">üí¨</span>
        <h3>Mensagens</h3>
        <p>Chat e convites</p>
        <span class="ac-badge" id="badgeMensagens" style="display:none;background:#ef4444;position:absolute;top:12px;right:12px;min-width:24px;height:24px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800">0</span>
      </div>
      <div class="action-card" onclick="nav('criar-jogo')"><span class="ac-icon">‚öΩ</span><h3>Criar Racha</h3><p>Organize peladas e rachas</p><span class="ac-badge">Gr√°tis</span></div>
      <div class="action-card" onclick="nav('criar-evento')"><span class="ac-icon">üìÖ</span><h3>Criar Evento</h3><p>Churrasco, festa e mais</p><span class="ac-badge">Gr√°tis</span></div>
      <div class="action-card" onclick="nav('usuarios')"><span class="ac-icon">üë•</span><h3>Usu√°rios</h3><p>Veja quem est√° online</p><span class="ac-badge" id="badgeOnline">0 online</span></div>
      <div class="action-card" id="cardTecnico"><span class="ac-icon">üéΩ</span><h3>T√©cnico <span id="lockTec" class="lock-ico">üîí</span></h3><p>Times e estrat√©gias</p><span class="ac-badge gold">30 dias gr√°tis</span></div>
    </div>
    <!-- Meus Times no dash -->
    <div id="secMeusTimesDash" class="sec" style="display:none"><h2>üõ°Ô∏è Meus Times</h2><div id="meusTimesDash"></div></div>
    <div class="sec"><h2>‚öΩ Meus Jogos</h2><div id="listaJogos"></div></div>
    <div class="sec"><h2>üìÖ Meus Eventos</h2><div id="listaEventos"></div></div>
  </div>
  <div class="bnav">
    <div class="bnav-item active" onclick="nav('dashboard')"><span class="bi">üè†</span><span class="bl">Home</span></div>
    <div class="bnav-item" onclick="nav('mensagens')" style="position:relative">
      <span class="bi">üí¨</span>
      <span class="bl">Mensagens</span>
      <span id="badgeMsgNav" style="display:none;position:absolute;top:4px;right:8px;background:#ef4444;color:#fff;border-radius:10px;padding:2px 6px;font-size:10px;font-weight:800;min-width:18px;text-align:center">0</span>
    </div>
    <div class="bnav-item" onclick="nav('criar-jogo')"><span class="bi">‚öΩ</span><span class="bl">Jogos</span></div>
    <div class="bnav-item" onclick="mostrarPerfil()"><span class="bi">üë§</span><span class="bl">Perfil</span></div>
  </div>
</div>

<!-- ============ CRIAR JOGO ============ -->
<div id="tela-criar-jogo" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1>‚öΩ Criar Jogo</h1>
    <p>Configure sua partida</p>
  </div>
  <div class="ctn">
    <div id="alertCriarJogo"></div>
    <div class="sec">
    <form id="formCriarJogo">
      <div class="fg"><label>Nome do Jogo</label><input type="text" id="cjNome" required placeholder="Pelada de Sexta"></div>
      <div class="fg" id="fgTipo"><label>Tipo</label><select id="cjTipo"><option value="racha">‚öΩ Racha (Casual)</option><option value="torneio">üèÜ Torneio (Iniciante+) üîí</option><option value="campeonato">üëë Campeonato (Profissional) üîí</option></select></div>
      <div class="fg"><label>Data e Hora</label><input type="datetime-local" id="cjData" required></div>
      <div class="fg"><label>Local</label><input type="text" id="cjLocal" required placeholder="Campo do SESI"></div>
      <div class="fg"><label>Modalidade</label><select id="cjModalidade"><option value="11">‚öΩ Futebol de Campo (11x11 ‚Äì 22 jogadores)</option><option value="7">ü•Ö Society (7x7 ‚Äì 14 jogadores)</option><option value="5">üèüÔ∏è Futsal/Sal√£o (5x5 ‚Äì 10 jogadores)</option><option value="2">üë§ X1 (1x1 ‚Äì 2 jogadores)</option><option value="volei">üèê Futev√¥lei (2x2 ou 3x3)</option><option value="areia">üèñÔ∏è Futebol de Areia (5x5)</option></select></div>
      <div class="fg"><label>Regra de T√©rmino</label><select id="cjRegra"><option value="2gols">2 gols vence</option><option value="10min">10 minutos</option><option value="ambos">2 gols OU 10 min</option></select></div>
      <button type="submit" class="btn">‚úÖ CRIAR RACHA</button>
      <button type="button" class="btn btn-sec" onclick="nav('dashboard')">‚Üê Voltar</button>
    </form>
  </div></div>
</div>

<!-- ============ CRIAR EVENTO ============ -->
<div id="tela-criar-evento" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1>üìÖ Criar Evento</h1>
    <p>Organize eventos</p>
  </div>
  <div class="ctn"><div class="sec">
    <form id="formCriarEvento">
      <div class="fg"><label>Nome</label><input type="text" id="ceNome" required placeholder="Churrasco do Grupo"></div>
      <div class="fg"><label>Tipo</label><select id="ceTipo"><option value="churrasco">üçñ Churrasco</option><option value="happy-hour">üç∫ Happy Hour</option><option value="torneio">üèÜ Torneio</option><option value="aniversario">üéÇ Anivers√°rio</option><option value="outro">üìÖ Outro</option></select></div>
      <div class="fg"><label>Data e Hora</label><input type="datetime-local" id="ceData" required></div>
      <div class="fg"><label>Local</label><input type="text" id="ceLocal" required placeholder="Casa do Jo√£o"></div>
      <div class="fg"><label>Descri√ß√£o</label><textarea id="ceDesc" placeholder="Detalhes..."></textarea></div>
      <div class="fg"><label>Valor por Pessoa (R$)</label><input type="number" id="ceValor" step="0.01" placeholder="0.00"></div>
      <button type="submit" class="btn">‚úÖ CRIAR EVENTO</button>
      <button type="button" class="btn btn-sec" onclick="nav('dashboard')">‚Üê Voltar</button>
    </form>
  </div></div>
</div>

<!-- ============ USU√ÅRIOS ============ -->
<div id="tela-usuarios" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1>üë• Usu√°rios</h1>
    <p>Cadastrados no ORGANIZE TIMES</p>
  </div>
  <div class="ctn">
    <div class="sec"><h2>üü¢ Online Agora</h2><div id="listaOnline"></div></div>
    <div class="sec"><h2>üìã Todos</h2><div id="listaTodos"></div></div>
  </div>
  <div class="bnav">
    <div class="bnav-item" onclick="nav('dashboard')"><span class="bi">üè†</span><span class="bl">Home</span></div>
    <div class="bnav-item" onclick="nav('criar-jogo')"><span class="bi">‚öΩ</span><span class="bl">Jogos</span></div>
    <div class="bnav-item active"><span class="bi">üë•</span><span class="bl">Usu√°rios</span></div>
    <div class="bnav-item" onclick="mostrarPerfil()"><span class="bi">üë§</span><span class="bl">Perfil</span></div>
  </div>
</div>

<!-- ============ PLANOS ============ -->
<div id="tela-planos" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1>üèÜ Planos T√©cnico</h1>
    <p>Escolha o ideal para voc√™</p>
  </div>
  <div class="ctn">
    <div id="alertPlanos"></div>
    <div class="planos-wrap">
      <!-- GR√ÅTIS -->
      <div class="plano-card free">
        <div class="plano-top"><div><h3>üòä Usu√°rio Gr√°tis</h3><div class="plano-sub">Sempre gr√°tis + 30 dias de teste completo</div></div></div>
        <div class="plano-price" style="color:#10b981">R$ 0,00 <span>/m√™s</span></div>
        <div class="plano-trial" style="background:rgba(16,185,129,0.12);color:#10b981">‚è∞ 30 dias para criar e gerenciar times gratuitamente</div>
        <ul class="plano-feats">
          <li><span class="feat-y">‚úì</span>Ser convidado para times</li>
          <li><span class="feat-y">‚úì</span>Criar rachas ilimitados</li>
          <li><span class="feat-y">‚úì</span>Participar de rachas, torneios e campeonatos</li>
          <li><span class="feat-y">‚úì</span>Criar 1 time e gerenciar por 30 dias</li>
          <li><span class="feat-y">‚úì</span>Ver seus jogadores</li>
          <li><span class="feat-y">‚úì</span>Votar no MVP (obrigat√≥rio para ver vota√ß√£o)</li>
          <li><span class="feat-y">‚úì</span>Ver classifica√ß√£o e tabelas dos jogos</li>
          <li><span class="feat-y">‚úì</span>Ver resultados dos jogos na sua cidade</li>
          <li><span class="feat-n">‚úó</span>Gerenciar time ap√≥s 30 dias (dados preservados)</li>
          <li><span class="feat-n">‚úó</span>Criar m√∫ltiplos times</li>
          <li><span class="feat-n">‚úó</span>Criar torneios e campeonatos</li>
        </ul>
        <div id="btnFreePlan"></div>
      </div>
      <!-- INICIANTE -->
      <div class="plano-card iniciante">
        <div class="plano-top"><div><h3 style="color:#f59e0b">‚≠ê T√©cnico Iniciante</h3><div class="plano-sub">Ideal para come√ßar</div></div></div>
        <div class="plano-price" style="color:#f59e0b">R$ 19,90 <span>/m√™s</span></div>
        <ul class="plano-feats">
          <li><span class="feat-y">‚úì</span>Tudo do plano Gr√°tis</li>
          <li><span class="feat-y">‚úì</span>Criar 1 time (sem limite de tempo)</li>
          <li><span class="feat-y">‚úì</span>Criar rachas ilimitados</li>
          <li><span class="feat-y">‚úì</span>Criar torneios (mata-mata)</li>
          <li><span class="feat-y">‚úì</span>Convidar jogadores (at√© 15 por time)</li>
          <li><span class="feat-y">‚úì</span>Classificar time por regi√£o</li>
          <li><span class="feat-y">‚úì</span>Escala√ß√£o autom√°tica</li>
          <li><span class="feat-y">‚úì</span>Dados preservados permanentemente</li>
          <li><span class="feat-n">‚úó</span>Criar campeonatos</li>
          <li><span class="feat-n">‚úó</span>Estat√≠sticas avan√ßadas</li>
        </ul>
        <div id="btnIniciante"></div>
      </div>
      <!-- PROFISSIONAL -->
      <div class="plano-card profissional">
        <div class="plano-ribbon">POPULAR</div>
        <div class="plano-top"><div><h3 style="color:#a78bfa">üèÜ T√©cnico Profissional</h3><div class="plano-sub">Tudo desbloqueado</div></div></div>
        <div class="plano-price" style="color:#a78bfa">R$ 39,90 <span>/m√™s</span></div>
        <ul class="plano-feats">
          <li><span class="feat-y">‚úì</span>Tudo do Iniciante</li>
          <li><span class="feat-y">‚úì</span>Criar 1 time (sem limite de tempo)</li>
          <li><span class="feat-y">‚úì</span>Criar rachas, torneios e campeonatos</li>
          <li><span class="feat-y">‚úì</span>Convidar jogadores sem limite</li>
          <li><span class="feat-y">‚úì</span>Dados preservados permanentemente</li>
          <li><span class="feat-y">‚úì</span>Classifica√ß√£o completa por regi√£o</li>
          <li><span class="feat-y">‚úì</span>Estat√≠sticas avan√ßadas</li>
          <li><span class="feat-y">‚úì</span>Exportar relat√≥rios</li>
        </ul>
        <div id="btnProfissional"></div>
      </div>
    </div>
  </div>
</div>

<!-- ============ T√âCNICO ============ -->
<div id="tela-tecnico" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1>üéΩ T√©cnico</h1>
    <p>Gerencia seus times</p>
  </div>
  <div class="ctn">
    <div id="alertTecnico"></div>
    
    <!-- BOT√ÉO GERENCIAR TIME AMADOR -->
    <div class="sec" style="background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05));border:2px solid rgba(16,185,129,0.3);text-align:center;padding:24px;margin-bottom:20px">
      <h2 style="margin-bottom:12px;color:#10b981">‚öΩ Time Amador Profissional</h2>
      <p style="color:#94a3b8;margin-bottom:16px;font-size:14px">Sistema completo de gerenciamento: elenco, forma√ß√£o, finan√ßas e muito mais!</p>
      <button class="btn btn-gold" onclick="abrirGerenciarTimeAmador()" style="width:100%;max-width:400px;margin:0 auto;display:flex;align-items:center;justify-content:center;gap:8px;font-size:16px">
        üèÜ GERENCIAR TIME AMADOR
      </button>
    </div>
    
    <!-- Criar Time -->
    <div class="sec" id="secCriarTime">
      <h2>‚ûï Criar Time Simples</h2>
      <form id="formCriarTime">
        <div class="fg"><label>Nome do Time</label><input type="text" id="ctNome" required placeholder="Estrelas do Norte"></div>
        <div class="fg"><label>Continente</label><select id="ctContinente"><option value="SA">üåé Am√©rica do Sul</option><option value="NA">üåé Am√©rica do Norte</option><option value="EU">üåç Europa</option><option value="AS">üåè √Åsia</option><option value="AF">üåç √Åfrica</option><option value="OC">üåè Oceania</option></select></div>
        <div class="fg"><label>Pa√≠s</label><input type="text" id="ctPais" required placeholder="Brasil"></div>
        <div class="fg"><label>Estado</label><input type="text" id="ctMunicipios" required placeholder="Sergipe"></div>
        <div class="fg"><label>Munic√≠pio</label><input type="text" id="ctMunico" required placeholder="Aracaju"></div>
        <div class="fg">
          <label>Bairro / Povoado</label>
          <select id="ctBairroSelect" onchange="toggleBairroCustom()" style="width:100%;padding:12px;background:rgba(15,23,42,0.6);border:2px solid rgba(100,116,139,0.3);border-radius:10px;color:#fff;font-size:14px">
            <option value="">Selecione o bairro/povoado</option>
            <option value="Centro">Centro</option>
            <option value="Zona Norte">Zona Norte</option>
            <option value="Zona Sul">Zona Sul</option>
            <option value="Zona Leste">Zona Leste</option>
            <option value="Zona Oeste">Zona Oeste</option>
            <option value="Periferia">Periferia</option>
            <option value="custom">‚úèÔ∏è Digitar outro...</option>
          </select>
          <input type="text" id="ctBairro" placeholder="Digite o nome do bairro ou povoado" style="display:none;margin-top:8px">
        </div>
        <button type="submit" class="btn">‚úÖ CRIAR TIME</button>
      </form>
    </div>
    <!-- Meus Times -->
    <div class="sec"><h2>üõ°Ô∏è Meus Times</h2><div id="listaMeusTimesT"></div></div>
    <!-- Classifica√ß√£o por Regi√£o -->
    <div class="sec">
      <h2>üó∫Ô∏è Times por Regi√£o</h2>
      <div class="filtro-row" id="filtroRegiao">
        <button class="filtro-btn ativo" onclick="filtrarTimes('todos',this)">üåç Todos</button>
        <button class="filtro-btn" onclick="filtrarTimes('continente',this)">üåé Continente</button>
        <button class="filtro-btn" onclick="filtrarTimes('pais',this)">üáßüá∑ Pa√≠s</button>
        <button class="filtro-btn" onclick="filtrarTimes('municipios',this)">üèõÔ∏è Estado</button>
        <button class="filtro-btn" onclick="filtrarTimes('municipio',this)">üìç Munic√≠pio</button>
        <button class="filtro-btn" onclick="filtrarTimes('bairro',this)">üèòÔ∏è Bairro</button>
      </div>
      <div id="listaTimesRegiao"></div>
    </div>
    <!-- Escala√ß√£o -->
    <div class="sec">
      <h2>üî≤ Escala√ß√£o R√°pida</h2>
      <div class="fg"><label>Selecione o Time</label><select id="escTime" onchange="gerarEscalacao()"></select></div>
      <div id="escalacaoDisplay"></div>
      <button class="btn btn-sm" onclick="gerarEscalacao()">üé≤ Sortear Novamente</button>
    </div>
    <button class="btn btn-sec" onclick="nav('dashboard')">‚Üê Voltar</button>
  </div>
</div>

<!-- ============ DETALHES TIME ============ -->
<div id="tela-time-detalhes" class="tela">
  <div class="hdr"><h1 id="tdTitulo">Time</h1><p id="tdInfo"></p></div>
  <div class="ctn">
    <div class="sec">
      <h2>üë• Jogadores</h2>
      <div id="tdJogadores"></div>
    </div>
    <!-- Convidar -->
    <div class="sec" id="secConvidar">
      <h2>üì± Convidar Jogador</h2>
      <div class="fg"><label>Nome</label><input type="text" id="convNome" placeholder="Pedro Santos"></div>
      <div class="fg"><label>Telefone (WhatsApp)</label><input type="tel" id="convTel" placeholder="(82) 99999-9999"></div>
      <button class="btn btn-sm" onclick="convidarJogador()">üì§ ENVIAR CONVITE</button>
    </div>
    <button class="btn btn-sec" onclick="nav('tecnico')">‚Üê Voltar</button>
  </div>
</div>

<!-- ============ JOGO ============ -->
<div id="tela-jogo" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1 id="jogTitulo">Jogo</h1>
    <p id="jogInfo"></p>
  </div>
  <div class="ctn">
    <div class="crono-box">
      <div class="crono-time" id="cronoDisplay" onclick="digitarTempo()" style="cursor:pointer" title="Clique para digitar tempo">00:00</div>
      <div class="placar-row">
        <div class="placar-side">
          <div class="placar-label">TIME A</div>
          <div class="placar-num" id="placarA">0</div>
          <div style="display:flex;gap:6px">
            <button class="btn btn-gol-menos" onclick="removerGol('A')">‚àí GOL</button>
            <button class="btn btn-gol" onclick="gol('A')">+ GOL</button>
          </div>
        </div>
        <div class="placar-side">
          <div class="placar-label">TIME B</div>
          <div class="placar-num" id="placarB">0</div>
          <div style="display:flex;gap:6px">
            <button class="btn btn-gol-menos" onclick="removerGol('B')">‚àí GOL</button>
            <button class="btn btn-gol" onclick="gol('B')">+ GOL</button>
          </div>
        </div>
      </div>
      
      <!-- CONTROLE DE TEMPO -->
      <div class="tempo-controle" id="tempoControle" style="display:none">
        <div class="tc-header">‚è±Ô∏è Controle de Tempo</div>
        <div class="tc-btns">
          <button class="tc-btn" onclick="ajustarTempo(-60)">-1 min</button>
          <button class="tc-btn" onclick="ajustarTempo(-10)">-10s</button>
          <button class="tc-btn tc-reset" onclick="resetarTempo()">‚ü≤ ZERAR</button>
          <button class="tc-btn" onclick="ajustarTempo(10)">+10s</button>
          <button class="tc-btn" onclick="ajustarTempo(60)">+1 min</button>
        </div>
        <div class="tc-btns" style="grid-template-columns:1fr">
          <button class="tc-btn" onclick="digitarTempo()" style="background:rgba(59,130,246,0.15);border-color:rgba(59,130,246,0.3);color:#60a5fa">‚å®Ô∏è DIGITAR TEMPO</button>
        </div>
        <div class="tc-info">Apenas o t√©cnico respons√°vel pode ajustar</div>
      </div>
      
      <div class="crono-btns">
        <button class="btn" id="btnPlay" onclick="playPause()">‚ñ∂ INICIAR</button>
        <button class="btn btn-sec" id="btnTempo" onclick="toggleControle()">‚è±Ô∏è TEMPO</button>
        <button class="btn btn-red" onclick="encerrarJogo()">üèÅ FINALIZAR</button>
      </div>
      <div class="crono-regra" id="cronoRegra"></div>
    </div>
    
    <!-- BANNER PUBLICIT√ÅRIO -->
    <div class="banner-pub">
      <div class="banner-conteudo">
        <div class="banner-icon">üëü</div>
        <div class="banner-texto">
          <div class="banner-titulo">OFERTA ESPECIAL!</div>
          <div class="banner-desc">Descontos em chuteiras e materiais esportivos</div>
        </div>
        <button class="banner-btn" onclick="alert('üõí Redirecionando para loja parceira...\n\nüí∞ Monetiza√ß√£o: Banner CPC/CPM\nReceita estimada: R$ 0,50 - R$ 2,00 por 1000 visualiza√ß√µes')">COMPRE AGORA</button>
      </div>
    </div>
    
    <!-- BOT√ïES CONVITES -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
      <button class="btn" onclick="mostrarConvites()" style="background:linear-gradient(135deg,#10b981,#059669);color:#000;display:flex;align-items:center;justify-content:center;gap:6px;font-size:14px">
        üí¨ Convidar Cadastrados
      </button>
      <button class="btn" onclick="gerarLinkConvite()" style="background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;display:flex;align-items:center;justify-content:center;gap:6px;font-size:14px">
        üîó Convidar Novos
      </button>
    </div>
    
    <!-- BOT√ïES P√ÅGINAS DEDICADAS -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px">
      <button class="btn btn-gold" onclick="abrirPaginaResultados()" style="display:flex;align-items:center;justify-content:center;gap:8px">
        üìä VER RESULTADOS
      </button>
      <button class="btn" onclick="abrirPaginaClassificacao()" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#000;display:flex;align-items:center;justify-content:center;gap:8px">
        üèÜ VER CLASSIFICA√á√ÉO
      </button>
      <button class="btn" onclick="abrirPaginaMvp()" style="background:linear-gradient(135deg,#f59e0b,#ea580c);color:#000;display:flex;align-items:center;justify-content:center;gap:8px">
        üó≥Ô∏è VOTAR MVP
      </button>
    </div>
    
    <!-- BANNER PUBLICIT√ÅRIO INFERIOR -->
    <div class="banner-pub" style="background:linear-gradient(90deg,#f59e0b,#d97706)">
      <div class="banner-conteudo">
        <div class="banner-icon">üèÜ</div>
        <div class="banner-texto">
          <div class="banner-titulo" style="color:#000">Upgrade para T√©cnico!</div>
          <div class="banner-desc" style="color:rgba(0,0,0,0.75)">Crie times, torneios e monetize seus eventos</div>
        </div>
        <button class="banner-btn" style="background:#000;color:#f59e0b" onclick="nav('planos')">VER PLANOS</button>
      </div>
    </div>
    
    <button class="btn btn-sec" onclick="nav('dashboard')">‚Üê Voltar</button>
  </div>
</div>

<!-- ============ P√ÅGINA RESULTADOS ============ -->
<div id="tela-pagina-resultados" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('jogo')">‚Üê Voltar</button>
    <h1 id="resJogoNome" style="background:linear-gradient(135deg,#10b981,#059669);-webkit-background-clip:text;-webkit-text-fill-color:transparent">üìä RESULTADOS</h1>
    <p id="resJogoInfo"></p>
  </div>
  <div class="ctn">
    <div class="estatisticas" id="estatisticasRes" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-bottom:20px;padding:16px;background:rgba(30,41,59,0.6);border-radius:12px;border:2px solid rgba(100,116,139,0.3)"></div>
    <div id="listaResultadosPagina"></div>
  </div>
</div>

<!-- ============ P√ÅGINA CLASSIFICA√á√ÉO ============ -->
<div id="tela-pagina-classificacao" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('jogo')">‚Üê Voltar</button>
    <h1 id="claJogoNome" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);-webkit-background-clip:text;-webkit-text-fill-color:transparent">üèÜ CLASSIFICA√á√ÉO</h1>
    <p id="claJogoInfo"></p>
  </div>
  <div class="ctn">
    <div class="alert" style="background:linear-gradient(135deg,rgba(59,130,246,0.15),rgba(59,130,246,0.05));border:2px solid rgba(59,130,246,0.3);border-radius:12px;padding:16px;margin-bottom:20px;color:#93c5fd;text-align:center">
      <strong style="color:#60a5fa">üìä Como funciona:</strong> A classifica√ß√£o √© baseada no <strong>menor tempo m√©dio</strong> para vencer. Quanto mais r√°pido voc√™ vence, melhor sua posi√ß√£o!
    </div>
    <div id="podioClassificacao"></div>
    <div id="tabelaClassificacaoPagina"></div>
  </div>
</div>

<!-- ============ P√ÅGINA MVP ============ -->
<div id="tela-pagina-mvp" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('jogo')">‚Üê Voltar</button>
    <h1 id="mvpJogoNome" style="background:linear-gradient(135deg,#fbbf24,#f59e0b);-webkit-background-clip:text;-webkit-text-fill-color:transparent">üó≥Ô∏è VOTA√á√ÉO MVP</h1>
    <p id="mvpJogoInfo"></p>
  </div>
  <div class="ctn">
    <div id="alertaMvpPagina"></div>
    <div id="conteudoMvpPagina"></div>
  </div>
</div>

<!-- ============ MENSAGENS (INBOX) ============ -->
<div id="tela-mensagens" class="tela">
  <div class="hdr" style="position:relative">
    <button class="btn-back" onclick="nav('dashboard')">‚Üê Voltar</button>
    <h1>üí¨ Mensagens</h1>
    <p>Conversas e convites</p>
  </div>
  <div class="ctn">
    <!-- Busca -->
    <div style="margin-bottom:16px">
      <input type="text" id="buscaConversa" placeholder="üîç Buscar conversas..." style="width:100%;padding:12px;background:rgba(15,23,42,0.6);border:2px solid rgba(100,116,139,0.3);border-radius:10px;color:#fff" oninput="filtrarConversas()">
    </div>
    
    <!-- Lista de Conversas -->
    <div id="listaConversas"></div>
  </div>
</div>

<!-- ============ CHAT (CONVERSA) ============ -->
<div id="tela-chat" class="tela">
  <div class="hdr" style="position:relative;padding:12px 16px">
    <button class="btn-back" onclick="nav('mensagens')" style="position:static;margin-right:12px;padding:8px 12px">‚Üê</button>
    <div style="display:flex;align-items:center;gap:12px;flex:1">
      <div id="chatAvatar" style="width:40px;height:40px;background:linear-gradient(135deg,#10b981,#059669);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;color:#000"></div>
      <div style="flex:1">
        <div id="chatNome" style="font-size:16px;font-weight:700;color:#cbd5e1"></div>
        <div id="chatStatus" style="font-size:12px;color:#64748b"></div>
      </div>
    </div>
  </div>
  
  <div id="chatMensagens" style="flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:12px;background:rgba(15,23,42,0.3)"></div>
  
  <div style="padding:16px;background:rgba(30,41,59,0.9);border-top:1px solid rgba(100,116,139,0.2)">
    <div style="display:flex;gap:8px">
      <input type="text" id="inputMensagem" placeholder="Digite sua mensagem..." style="flex:1;padding:12px;background:rgba(15,23,42,0.6);border:2px solid rgba(100,116,139,0.3);border-radius:10px;color:#fff" onkeypress="if(event.key==='Enter')enviarMensagem()">
      <button class="btn btn-primary" onclick="enviarMensagem()" style="padding:12px 20px;border-radius:10px">Enviar</button>
    </div>
  </div>
</div>

<!-- ============ SCRIPT ============ -->
<script>
/* ========== DB ========== */
const KEY='organize_v3';
function db(){const s=localStorage.getItem(KEY);return s?JSON.parse(s):{usuarios:[],jogos:[],eventos:[],times:[],logado:null}}
function save(d){localStorage.setItem(KEY,JSON.stringify(d))}
function me(){const d=db();return d.usuarios.find(u=>u.id===d.logado)}

/* ========== PLANOS ========== */
function getPlano(u){return u.plano||'free'}
function testeExpirado(u){
  // Apenas plano FREE tem teste de 30 dias
  if(u.plano==='free'&&u.criadoEm){
    const dias=(Date.now()-u.criadoEm)/(1000*60*60*24);
    return dias>30;
  }
  return false;
}
function diasRestantes(u){
  // Apenas plano FREE tem contador de dias
  if(u.plano==='free'&&u.criadoEm){
    const dias=30-Math.floor((Date.now()-u.criadoEm)/(1000*60*60*24));
    return dias>0?dias:0;
  }
  return 0;
}
function maxTimes(u){
  const p=getPlano(u);
  const exp=testeExpirado(u);
  // Todos os planos: apenas 1 time
  if(p==='profissional')return 1;
  if(p==='iniciante')return 1;
  if(p==='free'&&!exp)return 1;
  return 0
}
function maxConvites(u){
  const p=getPlano(u);
  if(p==='profissional')return 999;
  if(p==='iniciante'&&!testeExpirado(u))return 15;
  return 0
}

/* ========== LOGIN ========== */
function trocaBloco(w){
  console.log('Trocando para bloco:',w);
  document.getElementById('bloco-registro').style.display=w==='reg'?'block':'none';
  document.getElementById('bloco-login').style.display=w==='login'?'block':'none';
  document.getElementById('bloco-recuperar').style.display=w==='recuperar'?'block':'none';
  // Limpar alertas ao trocar
  document.getElementById('alert-login').innerHTML='';
  document.getElementById('alert-login2').innerHTML='';
  document.getElementById('alert-recuperar').innerHTML='';
}
function mostrarRecuperarSenha(){
  trocaBloco('recuperar');
  // Reset form
  document.getElementById('formRecuperar').reset();
  document.getElementById('campoNovaSenha').style.display='none';
  document.getElementById('campoConfNovaSenha').style.display='none';
  document.getElementById('btnRecuperar').textContent='üîç VERIFICAR DADOS';
  document.getElementById('btnRecuperar').onclick=null;
}
/* ========== FUN√á√ÉO GLOBAL DE CADASTRO ========== */
window.criarContaAgora = function() {
  alert('üîò Bot√£o clicado! Iniciando cadastro...');
  
  try {
    // Pegar valores
    const nome = document.getElementById('regNome').value.trim();
    const data = document.getElementById('regDataNasc').value.trim();
    const tel = document.getElementById('regTel').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const senha = document.getElementById('regSenha').value;
    const conf = document.getElementById('regSenhaConf').value;
    
    // Validar
    if(!nome) {
      alert('‚ùå Digite seu nome!');
      return;
    }
    
    if(!email) {
      alert('‚ùå Digite seu email!');
      return;
    }
    
    if(!senha) {
      alert('‚ùå Digite sua senha!');
      return;
    }
    
    if(senha !== conf) {
      alert('‚ùå As senhas n√£o s√£o iguais!');
      return;
    }
    
    // Pegar banco
    const db_str = localStorage.getItem('organize_v3');
    const db = db_str ? JSON.parse(db_str) : {usuarios:[], jogos:[], eventos:[], times:[], logado:null};
    
    // Verificar email
    const existe = db.usuarios.find(u => u.email === email);
    if(existe) {
      alert('‚ùå Email j√° cadastrado!\n\nFa√ßa login ou use outro email.');
      return;
    }
    
    // Criar usu√°rio
    const novo = {
      id: Date.now(),
      nome: nome,
      dataNascimento: data || '01/01/2000',
      telefone: tel || '',
      email: email,
      senha: senha,
      online: true,
      ultimoAcesso: Date.now(),
      plano: 'free',
      criadoEm: Date.now()
    };
    
    // Salvar
    db.usuarios.push(novo);
    db.logado = novo.id;
    localStorage.setItem('organize_v3', JSON.stringify(db));
    
    alert('‚úÖ CONTA CRIADA!\n\nBem-vindo, ' + nome + '! üéâ');
    
    // Recarregar
    setTimeout(function(){
      window.location.reload();
    }, 1000);
    
  } catch(erro) {
    alert('‚ùå ERRO: ' + erro.message);
    console.error(erro);
  }
};

// ===== CADASTRO SIMPLIFICADO - SEMPRE FUNCIONA =====
if(document.getElementById('formRegistro')){
  document.getElementById('formRegistro').addEventListener('submit',function(e){
    e.preventDefault();
    
    try {
      // Pegar valores direto
      const nome = document.getElementById('regNome').value;
      const data = document.getElementById('regDataNasc').value;
      const tel = document.getElementById('regTel').value;
      const email = document.getElementById('regEmail').value;
      const senha = document.getElementById('regSenha').value;
      const conf = document.getElementById('regSenhaConf').value;
      
      // Valida√ß√£o M√çNIMA
      if(!nome || !email || !senha) {
        alert('‚ùå Preencha pelo menos:\n‚Ä¢ Nome\n‚Ä¢ Email\n‚Ä¢ Senha');
        return;
      }
      
      if(senha !== conf) {
        alert('‚ùå As senhas n√£o s√£o iguais!');
        return;
      }
      
      // Criar usu√°rio DIRETO
      const db_data = localStorage.getItem('organize_v3');
      const db_obj = db_data ? JSON.parse(db_data) : {usuarios:[], jogos:[], eventos:[], times:[], logado:null};
      
      // Verificar email
      if(db_obj.usuarios.find(u => u.email === email)) {
        alert('‚ùå Email j√° cadastrado!\n\nUse outro email ou fa√ßa login.');
        return;
      }
      
      // Criar novo usu√°rio
      const novoUsuario = {
        id: Date.now(),
        nome: nome,
        dataNascimento: data || '01/01/2000',
        telefone: tel || '',
        email: email,
        senha: senha,
        online: true,
        ultimoAcesso: Date.now(),
        plano: 'free',
        criadoEm: Date.now()
      };
      
      // Salvar
      db_obj.usuarios.push(novoUsuario);
      db_obj.logado = novoUsuario.id;
      localStorage.setItem('organize_v3', JSON.stringify(db_obj));
      
      // Sucesso!
      alert('‚úÖ CONTA CRIADA COM SUCESSO!\n\nBem-vindo, ' + nome + '! üéâ');
      
      // Ir para dashboard
      setTimeout(function(){
        window.location.reload();
      }, 500);
      
    } catch(erro) {
      alert('‚ùå ERRO:\n' + erro.message + '\n\nTente novamente ou recarregue a p√°gina.');
      console.error(erro);
    }
  });
}
document.getElementById('formLogin').addEventListener('submit',function(e){
  e.preventDefault();
  
  console.log('Tentando fazer login...');
  
  const email=document.getElementById('logEmail').value;
  const senha=document.getElementById('logSenha').value;
  
  console.log('Email digitado:', email);
  console.log('Senha digitada:', senha ? '***' : '(vazio)');
  
  const d=db();
  console.log('Total de usu√°rios no banco:', d.usuarios.length);
  
  const u=d.usuarios.find(x=>x.email===email&&x.senha===senha);
  
  if(!u){
    console.log('Login falhou - usu√°rio n√£o encontrado');
    // Verificar se existe usu√°rio com esse email
    const emailExiste=d.usuarios.find(x=>x.email===email);
    if(emailExiste){
      document.getElementById('alert-login2').innerHTML='<div class="alert alert-err">‚ùå Senha incorreta!</div>';
      console.log('Email existe mas senha est√° errada');
    }else{
      document.getElementById('alert-login2').innerHTML='<div class="alert alert-err">‚ùå E-mail n√£o cadastrado! <a onclick="document.getElementById(\'bloco-login\').style.display=\'none\';document.getElementById(\'bloco-registro\').style.display=\'block\'" style="color:#10b981;cursor:pointer;text-decoration:underline">Criar conta</a></div>';
      console.log('Email n√£o existe no banco');
    }
    return;
  }
  
  console.log('Login bem-sucedido! Usu√°rio:', u.nome);
  
  u.online=true;
  u.ultimoAcesso=Date.now();
  d.logado=u.id;
  save(d);
  
  // Verificar se veio de um convite
  const convitePendente=sessionStorage.getItem('convite_pendente');
  if(convitePendente){
    const convite=JSON.parse(convitePendente);
    sessionStorage.removeItem('convite_pendente');
    
    // Processar convite
    if(convite.tipo==='jogo'&&convite.jogoId){
      const jogo=d.jogos.find(j=>j.id==convite.jogoId);
      if(jogo){
        if(!jogo.jogadores)jogo.jogadores=[];
        // Verificar se j√° n√£o est√° no jogo
        const jaEsta=jogo.jogadores.find(p=>p.id===u.id);
        if(!jaEsta){
          jogo.jogadores.push({id:u.id,nome:u.nome,status:'confirmado'});
          save(d);
          alert('‚úÖ Voc√™ foi adicionado ao jogo com sucesso! üéâ');
        }else{
          alert('‚ÑπÔ∏è Voc√™ j√° est√° neste jogo!');
        }
      }
    }
  }
  
  console.log('Navegando para dashboard...');
  nav('dashboard');
});

/* ========== RECUPERAR SENHA ========== */
let usuarioRecuperar=null;
document.getElementById('formRecuperar').addEventListener('submit',function(e){
  e.preventDefault();
  const d=db();
  const email=document.getElementById('recEmail').value;
  const tel=document.getElementById('recTel').value;
  
  // Verificar se ainda est√° na etapa 1 (verifica√ß√£o)
  if(!usuarioRecuperar){
    const u=d.usuarios.find(x=>x.email===email&&x.telefone===tel);
    if(!u){
      document.getElementById('alert-recuperar').innerHTML='<div class="alert alert-err">‚ùå E-mail ou telefone n√£o encontrados!</div>';
      return;
    }
    // Dados corretos - mostrar campos de nova senha
    usuarioRecuperar=u;
    document.getElementById('alert-recuperar').innerHTML='<div class="alert alert-ok">‚úÖ Dados verificados! Agora defina sua nova senha.</div>';
    document.getElementById('campoNovaSenha').style.display='block';
    document.getElementById('campoConfNovaSenha').style.display='block';
    document.getElementById('btnRecuperar').textContent='üîê REDEFINIR SENHA';
    document.getElementById('recNovaSenha').required=true;
    document.getElementById('recConfNovaSenha').required=true;
    return;
  }
  
  // Etapa 2 - redefinir senha
  const novaSenha=document.getElementById('recNovaSenha').value;
  const confSenha=document.getElementById('recConfNovaSenha').value;
  
  if(novaSenha!==confSenha){
    document.getElementById('alert-recuperar').innerHTML='<div class="alert alert-err">‚ùå As senhas n√£o coincidem!</div>';
    return;
  }
  
  // Atualizar senha
  const usr=d.usuarios.find(x=>x.id===usuarioRecuperar.id);
  usr.senha=novaSenha;
  save(d);
  
  document.getElementById('alert-recuperar').innerHTML='<div class="alert alert-ok">‚úÖ Senha redefinida com sucesso! Redirecionando...</div>';
  setTimeout(()=>{
    usuarioRecuperar=null;
    trocaBloco('login');
    document.getElementById('logEmail').value=email;
  },1500);
});

/* ========== NAV ========== */
function nav(tela){
  document.querySelectorAll('.tela,.tela-login').forEach(t=>{t.classList.remove('ativa');if(t.classList.contains('tela-login'))t.style.display='none'});
  const el=document.getElementById('tela-'+tela);
  if(el){el.classList.add('ativa');window.scrollTo(0,0)}
  if(tela==='dashboard')carregarDashboard();
  if(tela==='usuarios')carregarUsuarios();
  if(tela==='tecnico')carregarTecnico();
  if(tela==='planos')carregarPlanos();
  if(tela==='admin')carregarAdmin();
  if(tela==='mensagens')carregarMensagens();
  if(tela==='criar-jogo'){
    const u=me(),p=getPlano(u);
    const alertCJ=document.getElementById('alertCriarJogo');
    const selectTipo=document.getElementById('cjTipo');
    
    // Resetar todas as op√ß√µes
    document.querySelectorAll('#cjTipo option').forEach(opt=>opt.disabled=false);
    
    if(p==='free'){
      alertCJ.innerHTML='<div class="alert" style="background:rgba(16,185,129,0.1);border-color:rgba(16,185,129,0.3);color:#6ee7b7"><strong>üòä Conta Gr√°tis:</strong> Voc√™ pode criar <strong>Rachas</strong> ilimitados e <strong>participar</strong> de Torneios e Campeonatos criados por outros! Para criar Torneios e Campeonatos, fa√ßa upgrade. <button class="btn btn-sm btn-gold" style="margin:8px 0 0;width:auto;display:inline-flex" onclick="nav(\'planos\')">Ver Planos ‚Üí</button></div>';
      selectTipo.value='racha';
      // Bloquear torneio e campeonato
      selectTipo.querySelector('option[value="torneio"]').disabled=true;
      selectTipo.querySelector('option[value="campeonato"]').disabled=true;
    }else if(p==='iniciante'){
      alertCJ.innerHTML='<div class="alert alert-ok">‚úÖ <strong>Plano Iniciante:</strong> Voc√™ pode criar Rachas e Torneios! Upgrade para Profissional para criar Campeonatos.</div>';
      // Bloquear apenas campeonato
      selectTipo.querySelector('option[value="campeonato"]').disabled=true;
    }else{
      alertCJ.innerHTML='';
    }
  }
}
function mostrarPerfil(){
  const u=me();if(!u)return;
  const exp=testeExpirado(u);
  let idade='';
  if(u.dataNascimento){
    const hoje=new Date();
    const nasc=new Date(u.dataNascimento);
    let anos=hoje.getFullYear()-nasc.getFullYear();
    const m=hoje.getMonth()-nasc.getMonth();
    if(m<0||(m===0&&hoje.getDate()<nasc.getDate()))anos--;
    idade=`\nüéÇ Idade: ${anos} anos`;
  }
  const info=`üë§ ${u.nome}${idade}\nüìß ${u.email}\nüì± ${u.telefone}\nüèÜ Plano: ${getPlano(u).toUpperCase()}${u.plano==='iniciante'&&!exp?' ‚Äî Teste: '+diasRestantes(u)+' dias':u.plano==='iniciante'&&exp?' ‚Äî EXPIRADO':''}\n\nDeseja sair?`;
  if(confirm(info)){const d=db();d.logado=null;const usr=d.usuarios.find(x=>x.id===u.id);if(usr)usr.online=false;save(d);location.reload()}
}

/* ========== DASHBOARD ========== */
function carregarDashboard(){
  const u=me();
  if(!u){document.getElementById('tela-login').style.display='flex';return}
  document.getElementById('nomeUser').textContent=u.nome.split(' ')[0];

  // badge plano
  const p=getPlano(u),exp=testeExpirado(u);
  let bh='';
  if(p==='iniciante')bh=exp?'<span class="badge badge-red">‚ö†Ô∏è Expirado</span>':'<span class="badge badge-gold">‚≠ê Iniciante ‚Äì '+diasRestantes(u)+' dias</span>';
  if(p==='profissional')bh='<span class="badge badge-purple">üèÜ Profissional</span>';
  document.getElementById('userBadge').innerHTML=bh;

  // alerta expirado
  const ad=document.getElementById('alertDash');
  if(p==='free'){
    const expFree=testeExpirado(u);
    const diasFree=diasRestantes(u);
    if(expFree){
      ad.innerHTML='<div class="alert alert-warn">‚ö†Ô∏è Seus 30 dias de teste expiraram! Voc√™ ainda pode criar rachas e participar de jogos, mas n√£o pode mais gerenciar times. Dados preservados. <button class="btn btn-sm btn-gold" style="margin:8px 0 0;width:auto;display:inline-flex" onclick="nav(\'planos\')">‚≠ê Upgrade para T√©cnico</button></div>';
    }else{
      ad.innerHTML='<div class="alert" style="background:rgba(16,185,129,0.1);border-color:rgba(16,185,129,0.3);color:#6ee7b7"><strong>üòä Conta Gr√°tis:</strong> Voc√™ tem <strong>'+diasFree+' dias</strong> para criar e gerenciar 1 time gratuitamente! Pode criar rachas ilimitados, participar de todos os jogos e votar (vote para ver resultados). <button class="btn btn-sm btn-gold" style="margin:8px 0 0;width:auto;display:inline-flex" onclick="nav(\'planos\')">‚≠ê Ver Planos</button></div>';
    }
  }else{
    ad.innerHTML='';
  }

  // card t√©cnico
  const ct=document.getElementById('cardTecnico');
  const expFree=p==='free'&&testeExpirado(u);
  if(expFree){
    ct.classList.add('locked');ct.onclick=()=>nav('planos');document.getElementById('lockTec').style.display='inline';
  }else{
    ct.classList.remove('locked');ct.onclick=()=>nav('tecnico');document.getElementById('lockTec').style.display='none';
  }

  const d=db();
  document.getElementById('badgeOnline').textContent=d.usuarios.filter(x=>x.online).length+' online';

  // meus times no dash
  const mt=d.times.filter(t=>t.orgId===u.id);
  const smt=document.getElementById('secMeusTimesDash');
  if(mt.length&&p!=='free'){
    smt.style.display='block';
    document.getElementById('meusTimesDash').innerHTML=mt.map(t=>`<div class="item" onclick="abrirTimeDetalhes(${t.id})"><div class="item-top"><div class="item-title">üõ°Ô∏è ${t.nome}</div><span class="badge badge-grn">${t.jogadores.length} jogadores</span></div><div class="item-meta">üìç ${t.bairro} ‚Üí ${t.municipio} ‚Üí ${t.municipios} ‚Üí ${t.pais}</div></div>`).join('');
  }else smt.style.display='none';

  // jogos
  const jogos=d.jogos.filter(j=>j.orgId===u.id);
  const ic={racha:'‚öΩ',torneio:'üèÜ',campeonato:'üëë'};
  document.getElementById('listaJogos').innerHTML=jogos.length?jogos.map(j=>`<div class="item" onclick="abrirJogo(${j.id})"><div class="item-top"><div class="item-title">${ic[j.tipo]||'‚öΩ'} ${j.nome}</div><span class="badge badge-blu">${j.status}</span></div><div class="item-meta">üìÖ ${fmtDate(j.data)} &nbsp; üìç ${j.local} &nbsp; üë• ${j.modalidade} jog.</div></div>`).join(''):'<div style="text-align:center;padding:26px;color:#64748b"><div style="font-size:36px;margin-bottom:8px">‚öΩ</div><p style="margin-bottom:10px">Nenhum jogo criado</p><button class="btn btn-sm" style="display:flex;margin:0 auto" onclick="nav(\'criar-jogo\')">Criar Jogo</button></div>';

  // eventos
  const eventos=d.eventos.filter(e=>e.orgId===u.id);
  const ic2={churrasco:'üçñ','happy-hour':'üç∫',torneio:'üèÜ',aniversario:'üéÇ',outro:'üìÖ'};
  document.getElementById('listaEventos').innerHTML=eventos.length?eventos.map(e=>`<div class="item"><div class="item-top"><div class="item-title">${ic2[e.tipo]||'üìÖ'} ${e.nome}</div><span class="badge badge-blu">${e.status}</span></div><div class="item-meta">üìÖ ${fmtDate(e.data)} &nbsp; üìç ${e.local}${e.valor?' &nbsp; üí∞ R$'+e.valor.toFixed(2)+'/pess':''}</div></div>`).join(''):'<div style="text-align:center;padding:26px;color:#64748b"><div style="font-size:36px;margin-bottom:8px">üìÖ</div><p style="margin-bottom:10px">Nenhum evento criado</p><button class="btn btn-sm" style="display:flex;margin:0 auto" onclick="nav(\'criar-evento\')">Criar Evento</button></div>';
  
  // Atualizar badge de mensagens
  atualizarBadgeMensagens();
}

/* ========== CRIAR JOGO ========== */
document.getElementById('formCriarJogo').addEventListener('submit',function(e){
  e.preventDefault();const d=db(),u=me();
  d.jogos.push({id:Date.now(),orgId:u.id,criadorId:u.id,nome:document.getElementById('cjNome').value,tipo:document.getElementById('cjTipo').value,data:document.getElementById('cjData').value,local:document.getElementById('cjLocal').value,modalidade:document.getElementById('cjModalidade').value,regra:document.getElementById('cjRegra').value,status:'agendado',rodadas:[],votos:[],jogadores:[]});
  save(d);alert('‚úÖ Jogo criado!');e.target.reset();nav('dashboard');
});

/* ========== CRIAR EVENTO ========== */
document.getElementById('formCriarEvento').addEventListener('submit',function(e){
  e.preventDefault();const d=db(),u=me();
  d.eventos.push({id:Date.now(),orgId:u.id,nome:document.getElementById('ceNome').value,tipo:document.getElementById('ceTipo').value,data:document.getElementById('ceData').value,local:document.getElementById('ceLocal').value,descricao:document.getElementById('ceDesc').value,valor:document.getElementById('ceValor').value?parseFloat(document.getElementById('ceValor').value):null,status:'agendado'});
  save(d);alert('‚úÖ Evento criado!');e.target.reset();nav('dashboard');
});

/* ========== USU√ÅRIOS ========== */
function carregarUsuarios(){
  const d=db();
  const on=d.usuarios.filter(u=>u.online);
  document.getElementById('listaOnline').innerHTML=on.length?on.map(u=>userRow(u,true)).join(''):'<p style="color:#64748b;font-size:13px;padding:8px 0">Nenhum online agora</p>';
  document.getElementById('listaTodos').innerHTML=d.usuarios.map(u=>userRow(u,u.online)).join('');
}
function userRow(u,on){
  const ini=u.nome.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
  const p=getPlano(u);
  const ac=p==='iniciante'?'av-gold':p==='profissional'?'av-purple':'';
  let pb='';
  if(p==='iniciante')pb='<span class="badge badge-gold" style="font-size:10px">‚≠ê Ini</span>';
  if(p==='profissional')pb='<span class="badge badge-purple" style="font-size:10px">üèÜ Pro</span>';
  return`<div class="user-row"><div class="user-avatar ${ac}">${ini}</div><div class="user-row-info"><div class="user-row-name">${on?'<span class="online-dot"></span>':''}${u.nome} ${pb}</div><div class="user-row-sub">üì± ${u.telefone}</div></div>${on?'<span class="badge badge-grn">Online</span>':'<span class="badge badge-gry">Offline</span>'}</div>`;
}

/* ========== PLANOS ========== */
function carregarPlanos(){
  const u=me(),p=getPlano(u);
  document.getElementById('alertPlanos').innerHTML='';
  // Gr√°tis
  document.getElementById('btnFreePlan').innerHTML=p==='free'?'<div class="plano-atual-tag">‚úì Seu plano atual</div>':'';
  // Iniciante
  if(p==='iniciante'){
    document.getElementById('btnIniciante').innerHTML='<div class="plano-atual-tag" style="color:#f59e0b;background:rgba(245,158,11,0.15)">‚úì Seu plano atual</div>';
  }else if(p==='free'){
    document.getElementById('btnIniciante').innerHTML='<button class="btn btn-gold" onclick="ativarIniciante()">‚≠ê ASSINAR INICIANTE ‚Äì R$ 19,90/m√™s</button>';
  }else document.getElementById('btnIniciante').innerHTML='';
  // Profissional
  if(p==='profissional')document.getElementById('btnProfissional').innerHTML='<div class="plano-atual-tag" style="color:#a78bfa;background:rgba(139,92,246,0.15)">‚úì Seu plano atual</div>';
  else document.getElementById('btnProfissional').innerHTML='<button class="btn btn-purple" onclick="ativarProfissional()">üèÜ ASSINAR PROFISSIONAL ‚Äì R$ 39,90/m√™s</button>';
}
function ativarIniciante(){
  if(confirm('‚≠ê Assinar T√©cnico Iniciante ‚Äì R$ 19,90/m√™s?\n\n‚Ä¢ Criar 1 time (dados permanentes)\n‚Ä¢ Criar rachas e torneios\n‚Ä¢ Convidar at√© 15 jogadores\n‚Ä¢ Classifica√ß√£o por regi√£o\n\n(Simula√ß√£o de pagamento)')){
    const d=db(),u=d.usuarios.find(x=>x.id===me().id);
    u.plano='iniciante';save(d);
    alert('‚úÖ Plano Iniciante ativado!');carregarPlanos();
  }
}
function renovarIniciante(){
  if(confirm('üîÑ Renovar plano Iniciante ‚Äì R$ 19,90/m√™s?\n(Simula√ß√£o de pagamento)')){
    const d=db(),u=d.usuarios.find(x=>x.id===me().id);
    save(d);
    alert('‚úÖ Plano renovado!');carregarPlanos();
  }
}
function ativarProfissional(){
  if(confirm('üèÜ Assinar T√©cnico Profissional ‚Äì R$ 39,90/m√™s?\n\n‚Ä¢ Criar 1 time (dados permanentes)\n‚Ä¢ Criar rachas, torneios e campeonatos\n‚Ä¢ Convidar sem limite\n‚Ä¢ Estat√≠sticas avan√ßadas\n\n(Simula√ß√£o de pagamento)')){
    const d=db(),u=d.usuarios.find(x=>x.id===me().id);
    u.plano='profissional';save(d);
    alert('‚úÖ Plano Profissional ativado!');carregarPlanos();
  }
}

/* ========== T√âCNICO ========== */
function carregarTecnico(){
  const u=me(),p=getPlano(u);
  const exp=testeExpirado(u);
  
  // Se gr√°tis E expirado, redireciona para planos
  if(p==='free'&&exp){nav('planos');return}
  
  const at=document.getElementById('alertTecnico');
  
  if(p==='free'&&!exp){
    const dias=diasRestantes(u);
    at.innerHTML='<div class="alert" style="background:rgba(16,185,129,0.1);border-color:rgba(16,185,129,0.3);color:#6ee7b7">‚ú® <strong>Teste Gr√°tis:</strong> Voc√™ tem <strong>'+dias+' dias</strong> para criar e gerenciar 1 time gratuitamente! Ap√≥s esse per√≠odo, os dados ser√£o preservados mas voc√™ n√£o poder√° gerenciar. <button class="btn btn-sm btn-gold" style="margin:8px 0 0;width:auto;display:inline-flex" onclick="nav(\'planos\')">‚≠ê Upgrade Agora</button></div>';
    document.getElementById('secCriarTime').style.display='block';
  }else{
    at.innerHTML='<div class="alert alert-ok">‚úÖ Plano '+p.toUpperCase()+' ativo</div>';
    document.getElementById('secCriarTime').style.display='block';
  }
  carregarMeusTimesT();
  filtrarTimes('todos',document.querySelector('.filtro-btn.ativo'));
  carregarEscSelect();
}
document.getElementById('formCriarTime').addEventListener('submit',function(e){
  e.preventDefault();const d=db(),u=me();
  const meus=d.times.filter(t=>t.orgId===u.id);
  const max=maxTimes(u);
  const p=getPlano(u);
  if(meus.length>=max){
    let msg='‚ö†Ô∏è Limite atingido!\n\nCada conta pode criar apenas 1 time.\n';
    if(p==='free')msg+='Plano Gr√°tis: gerenciar por 30 dias.\nUpgrade para manter acesso permanente.';
    else msg+='Voc√™ j√° tem um time criado.';
    alert(msg);
    return;
  }
  
  const bairroSelect=document.getElementById('ctBairroSelect').value;
  const bairroCustom=document.getElementById('ctBairro').value;
  const bairroFinal=bairroSelect==='custom'?bairroCustom:bairroSelect;
  
  if(!bairroFinal){
    alert('‚ùå Por favor, selecione ou digite um bairro/povoado!');
    return;
  }
  
  d.times.push({id:Date.now(),orgId:u.id,nome:document.getElementById('ctNome').value,continente:document.getElementById('ctContinente').value,pais:document.getElementById('ctPais').value,municipios:document.getElementById('ctMunicipios').value,municipio:document.getElementById('ctMunico').value,bairro:bairroFinal,jogadores:[],criadoEm:Date.now()});
  save(d);alert('‚úÖ Time criado!');e.target.reset();
  document.getElementById('ctBairroSelect').value='';
  document.getElementById('ctBairro').style.display='none';
  carregarMeusTimesT();filtrarTimes('todos',document.querySelector('.filtro-btn.ativo'));carregarEscSelect();
});

function toggleBairroCustom(){
  const select=document.getElementById('ctBairroSelect');
  const input=document.getElementById('ctBairro');
  if(select.value==='custom'){
    input.style.display='block';
    input.required=true;
    input.focus();
  }else{
    input.style.display='none';
    input.required=false;
    input.value='';
  }
}

function abrirGerenciarTimeAmador(){
  const u=me();
  const p=getPlano(u);
  
  if(p==='free'){
    if(confirm('üèÜ GERENCIAR TIME AMADOR\n\nEste recurso premium est√° dispon√≠vel nos planos Iniciante e Profissional!\n\nInclui:\n‚Ä¢ Sistema completo de elenco\n‚Ä¢ Forma√ß√£o t√°tica\n‚Ä¢ Controle financeiro\n‚Ä¢ Registro de presen√ßa\n‚Ä¢ Dashboard avan√ßado\n\nDeseja ver os planos?')){
      nav('planos');
    }
    return;
  }
  
  window.open('GERENCIAR-TIME-AMADOR.html','_blank');
}

function carregarMeusTimesT(){
  const d=db(),u=me();
  const mt=d.times.filter(t=>t.orgId===u.id);
  const el=document.getElementById('listaMeusTimesT');
  if(!mt.length){el.innerHTML='<p style="color:#64748b;font-size:13px">Nenhum time criado ainda.</p>';return}
  el.innerHTML=mt.map(t=>`<div class="time-card"><div class="time-card-top"><div class="time-card-nome">üõ°Ô∏è ${t.nome}</div><button class="btn btn-sm btn-sec" style="font-size:12px" onclick="abrirTimeDetalhes(${t.id})">Abrir</button></div><div class="time-card-loc">üìç ${t.bairro} ‚Üí ${t.municipio} ‚Üí ${t.municipios} ‚Üí ${t.pais} (${contCont(t.continente)})<br>üë• ${t.jogadores.length} jogador${t.jogadores.length!==1?'es':''}</div><div class="time-jogadores">${t.jogadores.map(j=>`<span class="jog-tag ${j.status==='pendente'?'pend':''}">${j.nome}${j.status==='pendente'?' ‚è≥':''}</span>`).join('')}</div></div>`).join('');
}

/* ========== DETALHES TIME ========== */
let timeAtual=null;
function abrirTimeDetalhes(id){
  const d=db();timeAtual=d.times.find(t=>t.id===id);if(!timeAtual)return;
  document.getElementById('tdTitulo').textContent='üõ°Ô∏è '+timeAtual.nome;
  document.getElementById('tdInfo').textContent='üìç '+timeAtual.bairro+' ‚Üí '+timeAtual.municipio+' ‚Üí '+timeAtual.pais;
  renderTdJogadores();
  // esconder convidar se expirado
  const u=me(),exp=testeExpirado(u);
  const sc=document.getElementById('secConvidar');
  if(getPlano(u)==='iniciante'&&exp)sc.style.display='none';
  else sc.style.display='block';
  nav('time-detalhes');
}
function renderTdJogadores(){
  const el=document.getElementById('tdJogadores');
  if(!timeAtual.jogadores.length){el.innerHTML='<p style="color:#64748b;font-size:13px">Nenhum jogador convidado ainda.</p>';return}
  el.innerHTML=timeAtual.jogadores.map((j,i)=>`<div class="user-row"><div class="user-avatar" style="width:36px;height:36px;font-size:14px">${j.nome.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase()}</div><div class="user-row-info"><div class="user-row-name">${j.nome}</div><div class="user-row-sub">üì± ${j.telefone}</div></div><span class="badge ${j.status==='pendente'?'badge-ylw':'badge-grn'}">${j.status==='pendente'?'‚è≥ Pendente':'‚úì Confirmado'}</span></div>`).join('');
}
function convidarJogador(){
  const nome=document.getElementById('convNome').value.trim(),tel=document.getElementById('convTel').value.trim();
  if(!nome||!tel){alert('Preencha nome e telefone!');return}
  const d=db(),time=d.times.find(t=>t.id===timeAtual.id);
  if(time.jogadores.find(j=>j.telefone===tel)){alert('‚ö†Ô∏è Jogador j√° convidado!');return}
  const u=me();
  if(time.jogadores.length>=maxConvites(u)){alert('‚ö†Ô∏è Limite de '+maxConvites(u)+' jogadores por time no seu plano.\nUpgrade para Profissional para sem limite.');return}
  time.jogadores.push({nome:nome,telefone:tel,status:'pendente',convidoEm:Date.now()});
  save(d);timeAtual=time;
  document.getElementById('convNome').value='';document.getElementById('convTel').value='';
  alert('üì§ Convite enviado para '+nome+'!');renderTdJogadores();
}

/* ========== CLASSIFICA√á√ÉO TIMES ========== */
function filtrarTimes(filtro,btn){
  document.querySelectorAll('.filtro-btn').forEach(b=>b.classList.remove('ativo'));
  if(btn)btn.classList.add('ativo');
  const d=db(),all=d.times,el=document.getElementById('listaTimesRegiao');
  if(!all.length){el.innerHTML='<p style="color:#64748b;font-size:13px">Nenhum time cadastrado ainda.</p>';return}
  let grouped={};
  if(filtro==='todos')grouped={'üåç Todos os Times':all};
  else if(filtro==='continente')all.forEach(t=>{const k=contCont(t.continente);grouped[k]=grouped[k]||[];grouped[k].push(t)});
  else if(filtro==='pais')all.forEach(t=>{grouped[t.pais]=grouped[t.pais]||[];grouped[t.pais].push(t)});
  else if(filtro==='municipios')all.forEach(t=>{grouped[t.municipios]=grouped[t.municipios]||[];grouped[t.municipios].push(t)});
  else if(filtro==='municipio')all.forEach(t=>{grouped[t.municipio]=grouped[t.municipio]||[];grouped[t.municipio].push(t)});
  else if(filtro==='bairro')all.forEach(t=>{const k=t.bairro+', '+t.municipio;grouped[k]=grouped[k]||[];grouped[k].push(t)});

  let html='';
  Object.entries(grouped).sort((a,b)=>b[1].length-a[1].length).forEach(([titulo,times])=>{
    html+=`<div style="margin-bottom:12px"><div class="grupo-titulo">${titulo}<span class="badge badge-grn">${times.length} time${times.length!==1?'s':''}</span></div>`;
    times.forEach(t=>{
      html+=`<div class="time-card"><div class="time-card-top"><div class="time-card-nome">üõ°Ô∏è ${t.nome}</div><span class="badge badge-blu">${t.jogadores.length} jog.</span></div><div class="time-card-loc">üìç ${t.bairro} ‚Üí ${t.municipio} ‚Üí ${t.municipios} ‚Üí ${t.pais} (${contCont(t.continente)})</div>${t.jogadores.length?'<div class="time-jogadores">'+t.jogadores.slice(0,5).map(j=>`<span class="jog-tag">${j.nome}</span>`).join('')+(t.jogadores.length>5?`<span class="jog-tag" style="background:rgba(148,163,184,0.15);color:#94a3b8">+${t.jogadores.length-5}</span>`:'')+'</div>':''}</div>`;
    });
    html+='</div>';
  });
  el.innerHTML=html;
}
function contCont(c){return{SA:'Am√©rica do Sul',NA:'Am√©rica do Norte',EU:'Europa',AS:'√Åsia',AF:'√Åfrica',OC:'Oceania'}[c]||c}

/* ========== ESCALA√á√ÉO ========== */
function carregarEscSelect(){
  const d=db(),u=me(),mt=d.times.filter(t=>t.orgId===u.id);
  document.getElementById('escTime').innerHTML=mt.map(t=>`<option value="${t.id}">${t.nome} (${t.jogadores.length} jog.)</option>`).join('');
  if(mt.length)gerarEscalacao();
  else document.getElementById('escalacaoDisplay').innerHTML='<p style="color:#64748b;font-size:13px">Crie um time primeiro.</p>';
}
function gerarEscalacao(){
  const d=db(),tid=document.getElementById('escTime').value;
  const time=d.times.find(t=>String(t.id)===String(tid));
  if(!time){document.getElementById('escalacaoDisplay').innerHTML='';return}
  const pos=['Goleiro','Zagueiro','Zagueiro','Meio','Meio','Atacante','Atacante'];
  const nomes=[...time.jogadores].sort(()=>Math.random()-0.5).map(j=>j.nome);
  let html='<div style="margin:10px 0">';
  pos.forEach((p,i)=>{
    html+=`<div style="display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid rgba(148,163,184,0.08)"><span style="font-size:11px;color:#10b981;font-weight:700;min-width:64px;text-transform:uppercase">${p}</span><span style="font-size:13px;color:#fff">${nomes[i]||'‚Äî Vaga ‚Äî'}</span></div>`;
  });
  html+='</div>';
  document.getElementById('escalacaoDisplay').innerHTML=html;
}

/* ========== JOGO / CRON√îMETRO ========== */
let jogoAtual=null,cronoSecs=0,cronoRunning=false,cronoTimer=null,votoSelecionado=null,tempoInicial=600;

// Sons de apito do juiz
function apitoInicio(){
  const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.connect(gain);gain.connect(audioCtx.destination);
  osc.frequency.value=800;
  osc.type='square';
  gain.gain.setValueAtTime(0.3,audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.3);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime+0.3);
}
function apitoPausa(){
  const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  [0,0.15].forEach(delay=>{
    const osc=audioCtx.createOscillator();
    const gain=audioCtx.createGain();
    osc.connect(gain);gain.connect(audioCtx.destination);
    osc.frequency.value=600;
    osc.type='square';
    gain.gain.setValueAtTime(0.3,audioCtx.currentTime+delay);
    gain.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+delay+0.15);
    osc.start(audioCtx.currentTime+delay);
    osc.stop(audioCtx.currentTime+delay+0.15);
  });
}
function apitoFinal(){
  const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  [0,0.2,0.4].forEach(delay=>{
    const osc=audioCtx.createOscillator();
    const gain=audioCtx.createGain();
    osc.connect(gain);gain.connect(audioCtx.destination);
    osc.frequency.value=700;
    osc.type='square';
    gain.gain.setValueAtTime(0.3,audioCtx.currentTime+delay);
    gain.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+delay+0.25);
    osc.start(audioCtx.currentTime+delay);
    osc.stop(audioCtx.currentTime+delay+0.25);
  });
}

function abrirJogo(id){
  const d=db();jogoAtual=d.jogos.find(j=>j.id===id);if(!jogoAtual)return;
  document.getElementById('jogTitulo').textContent=jogoAtual.nome;
  document.getElementById('jogInfo').textContent='üìç '+jogoAtual.local;
  const regras={'2gols':'Termina com 2 gols','10min':'10 minutos','ambos':'2 gols OU 10 min'};
  document.getElementById('cronoRegra').textContent=regras[jogoAtual.regra]||'';
  
  // Definir tempo inicial baseado na regra
  if(jogoAtual.regra==='10min'||jogoAtual.regra==='ambos'){
    tempoInicial=600; // 10 minutos
  }else{
    tempoInicial=600; // padr√£o 10 minutos
  }
  
  // Carregar estado ao vivo se existir
  if(jogoAtual.estadoAoVivo){
    const estado=jogoAtual.estadoAoVivo;
    document.getElementById('placarA').textContent=estado.placarA||'0';
    document.getElementById('placarB').textContent=estado.placarB||'0';
    cronoSecs=estado.tempo||tempoInicial;
    document.getElementById('cronoDisplay').textContent=fmtTime(cronoSecs);
    // Se est√° rodando e foi atualizado recentemente (menos de 5 segundos)
    if(estado.rodando&&(Date.now()-estado.ultimaAtualizacao)<5000){
      document.getElementById('btnPlay').textContent='‚è∏ PAUSAR (Ao Vivo)';
    }else{
      document.getElementById('btnPlay').textContent='‚ñ∂ INICIAR';
    }
  }else{
    cronoSecs=tempoInicial;
    document.getElementById('cronoDisplay').textContent=fmtTime(tempoInicial);
    document.getElementById('placarA').textContent='0';
    document.getElementById('placarB').textContent='0';
    document.getElementById('btnPlay').textContent='‚ñ∂ INICIAR';
  }
  
  cronoRunning=false;clearInterval(cronoTimer);votoSelecionado=null;
  // trocarTab('resultados'); // REMOVIDO - pain√©is agora s√£o p√°ginas separadas
  nav('jogo');
  
  // Verificar se o usu√°rio atual √© o criador do jogo
  const u=me();
  const ehCriador=jogoAtual.criadorId===u.id;
  const btnTempo=document.getElementById('btnTempo');
  const controle=document.getElementById('tempoControle');
  
  if(ehCriador){
    btnTempo.style.display='flex';
    controle.style.display='none';
  }else{
    btnTempo.style.display='none';
    controle.style.display='none';
  }
  
  // Iniciar observador (atualiza a cada 2 segundos)
  clearInterval(window.observadorTimer);
  window.observadorTimer=setInterval(()=>{
    const d2=db(),j2=d2.jogos.find(x=>x.id===jogoAtual.id);
    if(j2&&j2.estadoAoVivo&&!cronoRunning){
      // Atualizar apenas se eu n√£o estou controlando o jogo
      const e=j2.estadoAoVivo;
      if(parseInt(document.getElementById('placarA').textContent)!==e.placarA||parseInt(document.getElementById('placarB').textContent)!==e.placarB||cronoSecs!==e.tempo){
        document.getElementById('placarA').textContent=e.placarA||'0';
        document.getElementById('placarB').textContent=e.placarB||'0';
        cronoSecs=e.tempo;
        document.getElementById('cronoDisplay').textContent=fmtTime(cronoSecs);
      }
    }
  },2000);
}

function abrirPaginaResultados(){
  if(!jogoAtual){
    alert('‚ùå Nenhum jogo selecionado!');
    return;
  }
  carregarPaginaResultados();
  nav('pagina-resultados');
}

function abrirPaginaClassificacao(){
  if(!jogoAtual){
    alert('‚ùå Nenhum jogo selecionado!');
    return;
  }
  carregarPaginaClassificacao();
  nav('pagina-classificacao');
}

function abrirPaginaMvp(){
  if(!jogoAtual){
    alert('‚ùå Nenhum jogo selecionado!');
    return;
  }
  carregarPaginaMvp();
  nav('pagina-mvp');
}

// CARREGAR P√ÅGINA RESULTADOS
function carregarPaginaResultados(){
  document.getElementById('resJogoNome').textContent=jogoAtual.nome;
  document.getElementById('resJogoInfo').textContent='üìç '+jogoAtual.local+' ‚Ä¢ üìÖ '+new Date(jogoAtual.data).toLocaleDateString('pt-BR');
  
  const rodadas=jogoAtual.rodadas||[];
  const totalRodadas=rodadas.length;
  const totalGols=rodadas.reduce((acc,r)=>acc+r.golsA+r.golsB,0);
  const vitoriasA=rodadas.filter(r=>r.golsA>r.golsB).length;
  const vitoriasB=rodadas.filter(r=>r.golsB>r.golsA).length;
  const empates=rodadas.filter(r=>r.golsA===r.golsB).length;
  
  document.getElementById('estatisticasRes').innerHTML=`
    <div class="stat-item">
      <div class="stat-num">${totalRodadas}</div>
      <div class="stat-label">Rodadas</div>
    </div>
    <div class="stat-item">
      <div class="stat-num">${totalGols}</div>
      <div class="stat-label">Gols</div>
    </div>
    <div class="stat-item">
      <div class="stat-num">${vitoriasA}</div>
      <div class="stat-label">Vit. A</div>
    </div>
    <div class="stat-item">
      <div class="stat-num">${vitoriasB}</div>
      <div class="stat-label">Vit. B</div>
    </div>
    <div class="stat-item">
      <div class="stat-num">${empates}</div>
      <div class="stat-label">Empates</div>
    </div>
  `;
  
  if(rodadas.length===0){
    document.getElementById('listaResultadosPagina').innerHTML='<div style="text-align:center;padding:60px 20px;color:#64748b"><div style="font-size:64px;margin-bottom:16px">‚öΩ</div><p style="font-size:16px;font-weight:600">Nenhuma rodada jogada ainda</p></div>';
    return;
  }
  
  let html='';
  rodadas.forEach((r,i)=>{
    const vencedor=r.golsA>r.golsB?'üèÜ '+r.timeA+' Venceu!':
                   r.golsB>r.golsA?'üèÜ '+r.timeB+' Venceu!':
                   'ü§ù Empate!';
    
    html+=`
      <div class="rodada-card-pagina">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px">
          <div style="font-size:18px;font-weight:700;color:#10b981">‚öΩ Rodada ${i+1}</div>
          <div style="font-size:14px;color:#fbbf24;background:rgba(245,158,11,0.15);padding:6px 12px;border-radius:8px;font-weight:600">‚è±Ô∏è ${fmtTime(r.tempoSegs)}</div>
        </div>
        <div style="display:flex;justify-content:center;align-items:center;gap:20px;font-size:20px;font-weight:800;margin-bottom:12px">
          <div style="color:#cbd5e1;min-width:100px;text-align:center">${r.timeA}</div>
          <div style="background:linear-gradient(135deg,#10b981,#059669);color:#000;width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 4px 12px rgba(16,185,129,0.3)">${r.golsA}</div>
          <div style="color:#64748b">√ó</div>
          <div style="background:linear-gradient(135deg,#10b981,#059669);color:#000;width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 4px 12px rgba(16,185,129,0.3)">${r.golsB}</div>
          <div style="color:#cbd5e1;min-width:100px;text-align:center">${r.timeB}</div>
        </div>
        <div style="text-align:center;padding:10px;background:${r.golsA===r.golsB?'rgba(59,130,246,0.15)':'rgba(245,158,11,0.15)'};border-radius:8px;color:${r.golsA===r.golsB?'#60a5fa':'#fbbf24'};font-weight:700;font-size:14px">${vencedor}</div>
      </div>
    `;
  });
  
  document.getElementById('listaResultadosPagina').innerHTML=html;
}

// CARREGAR P√ÅGINA CLASSIFICA√á√ÉO
function carregarPaginaClassificacao(){
  document.getElementById('claJogoNome').textContent=jogoAtual.nome;
  document.getElementById('claJogoInfo').textContent='üìç '+jogoAtual.local+' ‚Ä¢ üìÖ '+new Date(jogoAtual.data).toLocaleDateString('pt-BR');
  
  const rodadas=jogoAtual.rodadas||[];
  
  if(rodadas.length===0){
    document.getElementById('tabelaClassificacaoPagina').innerHTML='<div style="text-align:center;padding:60px 20px;color:#64748b"><div style="font-size:64px;margin-bottom:16px">üèÜ</div><p style="font-size:16px;font-weight:600">Nenhum dado de classifica√ß√£o ainda</p></div>';
    document.getElementById('podioClassificacao').innerHTML='';
    return;
  }
  
  const stats={};
  
  rodadas.forEach(r=>{
    if(!stats[r.timeA]){
      stats[r.timeA]={nome:r.timeA,vitorias:0,derrotas:0,empates:0,tempos:[]};
    }
    if(r.golsA>r.golsB){
      stats[r.timeA].vitorias++;
      stats[r.timeA].tempos.push(r.tempoSegs);
    }else if(r.golsA<r.golsB){
      stats[r.timeA].derrotas++;
    }else{
      stats[r.timeA].empates++;
    }
    
    if(!stats[r.timeB]){
      stats[r.timeB]={nome:r.timeB,vitorias:0,derrotas:0,empates:0,tempos:[]};
    }
    if(r.golsB>r.golsA){
      stats[r.timeB].vitorias++;
      stats[r.timeB].tempos.push(r.tempoSegs);
    }else if(r.golsB<r.golsA){
      stats[r.timeB].derrotas++;
    }else{
      stats[r.timeB].empates++;
    }
  });
  
  const ranking=Object.values(stats).map(s=>{
    const tempoMedio=s.tempos.length?s.tempos.reduce((a,b)=>a+b,0)/s.tempos.length:Infinity;
    return {...s,tempoMedio};
  }).sort((a,b)=>a.tempoMedio-b.tempoMedio);
  
  // P√ìDIO
  if(ranking.length>=3){
    const p1=ranking[0],p2=ranking[1],p3=ranking[2];
    document.getElementById('podioClassificacao').innerHTML=`
      <div class="podio-box">
        <div class="podio-item segundo">
          <div class="podio-medal">ü•à</div>
          <div class="podio-base">
            <div class="podio-time">${p2.nome}</div>
            <div class="podio-stats">${p2.vitorias} vit√≥ria${p2.vitorias>1?'s':''}</div>
            <div class="podio-tempo">${fmtTime(Math.round(p2.tempoMedio))}</div>
          </div>
        </div>
        <div class="podio-item primeiro">
          <div class="podio-medal">ü•á</div>
          <div class="podio-base">
            <div class="podio-time">${p1.nome}</div>
            <div class="podio-stats">${p1.vitorias} vit√≥ria${p1.vitorias>1?'s':''}</div>
            <div class="podio-tempo">${fmtTime(Math.round(p1.tempoMedio))}</div>
          </div>
        </div>
        <div class="podio-item terceiro">
          <div class="podio-medal">ü•â</div>
          <div class="podio-base">
            <div class="podio-time">${p3.nome}</div>
            <div class="podio-stats">${p3.vitorias} vit√≥ria${p3.vitorias>1?'s':''}</div>
            <div class="podio-tempo">${fmtTime(Math.round(p3.tempoMedio))}</div>
          </div>
        </div>
      </div>
    `;
  }else{
    document.getElementById('podioClassificacao').innerHTML='';
  }
  
  // TABELA
  let html='<div class="sec"><h2>üìä Ranking Completo</h2>';
  ranking.forEach((t,i)=>{
    const emoji=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';
    const tempo=t.tempoMedio===Infinity?'--:--':fmtTime(Math.round(t.tempoMedio));
    const cor=i===0?'#fbbf24':i===1?'#cbd5e1':i===2?'#fb923c':'#60a5fa';
    
    html+=`
      <div style="background:rgba(30,41,59,0.6);border:2px solid rgba(100,116,139,0.3);border-radius:12px;padding:16px;margin-bottom:12px;display:grid;grid-template-columns:60px 1fr 80px 80px;gap:12px;align-items:center">
        <div style="font-size:24px;font-weight:800;color:${cor};text-align:center">${emoji}${i+1}¬∫</div>
        <div style="font-size:16px;font-weight:700;color:#cbd5e1">${t.nome}</div>
        <div style="text-align:center;font-size:18px;font-weight:700;color:#10b981">${t.vitorias}</div>
        <div style="text-align:center;font-size:16px;font-weight:700;color:#fbbf24">${tempo}</div>
      </div>
    `;
  });
  html+='</div>';
  
  document.getElementById('tabelaClassificacaoPagina').innerHTML=html;
}

// CARREGAR P√ÅGINA MVP
let jogadorSelecionadoInt=null;

function carregarPaginaMvp(){
  document.getElementById('mvpJogoNome').textContent=jogoAtual.nome;
  document.getElementById('mvpJogoInfo').textContent='üìç '+jogoAtual.local+' ‚Ä¢ üìÖ '+new Date(jogoAtual.data).toLocaleDateString('pt-BR');
  
  const u=me();
  if(!u){
    document.getElementById('conteudoMvpPagina').innerHTML='<div class="alert" style="background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.3);color:#fca5a5">üîí Voc√™ precisa estar logado para votar</div>';
    document.getElementById('alertaMvpPagina').innerHTML='';
    return;
  }
  
  const votos=jogoAtual.votos||[];
  const jaVotou=votos.find(v=>v.votanteId===u.id);
  
  if(jaVotou){
    mostrarResultadosMvpInterno();
  }else{
    mostrarVotacaoInterna();
  }
}

function mostrarVotacaoInterna(){
  const jogadores=[
    {id:1,nome:'Jo√£o Silva',tipo:'Cadastrado'},
    {id:2,nome:'Maria Santos',tipo:'Visitante'},
    {id:3,nome:'Pedro Costa',tipo:'Cadastrado'},
    {id:4,nome:'Ana Oliveira',tipo:'Visitante'},
    {id:5,nome:'Carlos Lima',tipo:'Cadastrado'},
    {id:6,nome:'Julia Mendes',tipo:'Cadastrado'},
    {id:7,nome:'Rafael Souza',tipo:'Visitante'},
    {id:8,nome:'Beatriz Dias',tipo:'Cadastrado'}
  ];
  
  document.getElementById('alertaMvpPagina').innerHTML='<div class="alert" style="background:rgba(16,185,129,0.1);border-color:rgba(16,185,129,0.3);color:#6ee7b7"><strong>‚úÖ Voc√™ ainda n√£o votou!</strong> Selecione o melhor jogador e confirme seu voto.</div>';
  
  let html='<div style="margin-bottom:16px">';
  jogadores.forEach(j=>{
    const inicial=j.nome.charAt(0).toUpperCase();
    html+=`
      <div class="jogador-card-int" onclick="selecionarJogadorInt(${j.id})" id="card-int-${j.id}">
        <div class="jogador-info-int">
          <div class="jogador-avatar-int">${inicial}</div>
          <div>
            <div class="jogador-nome-int">${j.nome}</div>
            <div class="jogador-badge-int">${j.tipo}</div>
          </div>
        </div>
        <div style="color:#94a3b8;font-size:20px">‚Üí</div>
      </div>
    `;
  });
  html+='</div><button class="btn btn-gold" id="btnVotarInt" onclick="confirmarVotoInterno()" disabled style="width:100%">‚úÖ CONFIRMAR VOTO</button>';
  
  document.getElementById('conteudoMvpPagina').innerHTML=html;
}

function selecionarJogadorInt(id){
  jogadorSelecionadoInt=id;
  document.querySelectorAll('.jogador-card-int').forEach(c=>c.classList.remove('selecionado-int'));
  document.getElementById('card-int-'+id).classList.add('selecionado-int');
  document.getElementById('btnVotarInt').disabled=false;
}

function confirmarVotoInterno(){
  if(!jogadorSelecionadoInt){
    alert('‚ö†Ô∏è Selecione um jogador primeiro!');
    return;
  }
  
  if(!confirm('‚úÖ Confirmar voto neste jogador?\n\n‚ö†Ô∏è Voc√™ N√ÉO poder√° mudar seu voto depois!')){
    return;
  }
  
  const d=db(),u=me();
  const jogo=d.jogos.find(j=>j.id===jogoAtual.id);
  
  if(!jogo.votos)jogo.votos=[];
  jogo.votos.push({
    votanteId:u.id,
    jogadorId:jogadorSelecionadoInt,
    timestamp:Date.now()
  });
  
  save(d);
  jogoAtual=jogo;
  
  alert('‚úÖ Voto confirmado com sucesso!');
  carregarPaginaMvp();
}

function mostrarResultadosMvpInterno(){
  const votos=jogoAtual.votos||[];
  
  if(votos.length===0){
    document.getElementById('conteudoMvpPagina').innerHTML='<div style="text-align:center;padding:60px 20px;color:#64748b"><div style="font-size:64px;margin-bottom:16px">üó≥Ô∏è</div><p style="font-size:16px;font-weight:600">Nenhum voto registrado ainda</p></div>';
    document.getElementById('alertaMvpPagina').innerHTML='';
    return;
  }
  
  const contagem={};
  votos.forEach(v=>{
    if(!contagem[v.jogadorId])contagem[v.jogadorId]=0;
    contagem[v.jogadorId]++;
  });
  
  const ranking=Object.entries(contagem)
    .map(([id,votos])=>({id:parseInt(id),votos}))
    .sort((a,b)=>b.votos-a.votos);
  
  const nomes={
    1:'Jo√£o Silva',2:'Maria Santos',3:'Pedro Costa',4:'Ana Oliveira',
    5:'Carlos Lima',6:'Julia Mendes',7:'Rafael Souza',8:'Beatriz Dias'
  };
  
  const vencedor=ranking[0];
  
  let html=`
    <div class="vencedor-mvp-int">
      <div class="trofeu-int">üèÜ</div>
      <div class="vencedor-nome-int">${nomes[vencedor.id]}</div>
      <div class="vencedor-votos-int">MVP com ${vencedor.votos} voto${vencedor.votos>1?'s':''}</div>
    </div>
    <div class="alert" style="background:rgba(16,185,129,0.1);border-color:rgba(16,185,129,0.3);color:#6ee7b7"><strong>‚úÖ Voc√™ j√° votou!</strong> Confira o ranking completo abaixo.</div>
    <div style="margin-top:20px">
  `;
  
  ranking.forEach((r,i)=>{
    const inicial=nomes[r.id].charAt(0).toUpperCase();
    const emoji=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';
    
    html+=`
      <div class="jogador-card-int">
        <div class="jogador-info-int">
          <div class="jogador-avatar-int">${inicial}</div>
          <div>
            <div class="jogador-nome-int">${emoji} ${nomes[r.id]}</div>
            <div class="jogador-badge-int">${i+1}¬∫ Lugar</div>
          </div>
        </div>
        <div class="votos-count-int">
          <div class="votos-num-int">${r.votos}</div>
          <div class="votos-label-int">voto${r.votos>1?'s':''}</div>
        </div>
      </div>
    `;
  });
  
  html+='</div>';
  document.getElementById('conteudoMvpPagina').innerHTML=html;
  document.getElementById('alertaMvpPagina').innerHTML='';
}


function playPause(){
  if(cronoRunning){
    cronoRunning=false;clearInterval(cronoTimer);
    apitoPausa();
    document.getElementById('btnPlay').textContent='‚ñ∂ RETOMAR';
    atualizarObservadores();
  }else{
    cronoRunning=true;
    apitoInicio();
    document.getElementById('btnPlay').textContent='‚è∏ PAUSAR';
    cronoTimer=setInterval(()=>{
      // DECRESCENTE: diminui tempo
      cronoSecs--;
      
      // Se chegou a zero
      if(cronoSecs<=0){
        cronoSecs=0;
        document.getElementById('cronoDisplay').textContent='00:00';
        apitoFinal();
        cronoRunning=false;
        clearInterval(cronoTimer);
        document.getElementById('btnPlay').textContent='‚ñ∂ RETOMAR';
        alert('‚è∞ TEMPO ACABOU!');
        salvarRodada();
        atualizarObservadores();
        return;
      }
      
      document.getElementById('cronoDisplay').textContent=fmtTime(cronoSecs);
      atualizarObservadores();
      
      // Alerta quando falta 1 minuto
      if(cronoSecs===60){
        beep();
        setTimeout(()=>alert('‚è∞ Falta 1 minuto!'),100);
      }
      
      // Alerta nos √∫ltimos 10 segundos
      if(cronoSecs<=10&&cronoSecs>0){
        beep();
      }
    },1000);
  }
}
function gol(lado){
  const eA=document.getElementById('placarA'),eB=document.getElementById('placarB');
  if(lado==='A')eA.textContent=parseInt(eA.textContent)+1;else eB.textContent=parseInt(eB.textContent)+1;
  beep();
  atualizarObservadores();
  if(jogoAtual.regra==='2gols'||jogoAtual.regra==='ambos'){
    if(parseInt(eA.textContent)>=2||parseInt(eB.textContent)>=2){
      apitoFinal();
      cronoRunning=false;clearInterval(cronoTimer);document.getElementById('btnPlay').textContent='‚ñ∂ RETOMAR';
      alert('‚öΩ 2 GOLS! Rodada encerrada.');salvarRodada();
      atualizarObservadores();
    }
  }
}
function removerGol(lado){
  const eA=document.getElementById('placarA'),eB=document.getElementById('placarB');
  const el=lado==='A'?eA:eB;
  const atual=parseInt(el.textContent);
  if(atual>0){
    if(confirm(`Remover 1 gol do Time ${lado}?\n\n${atual} ‚Üí ${atual-1} gols`)){
      el.textContent=atual-1;
      beep();
      atualizarObservadores();
    }
  }else{
    alert('‚ö†Ô∏è Time j√° est√° com 0 gols!');
  }
}
function atualizarObservadores(){
  // Salvar estado atual do jogo no banco para outros usu√°rios acompanharem
  const d=db(),j=d.jogos.find(x=>x.id===jogoAtual.id);
  if(!j.estadoAoVivo)j.estadoAoVivo={};
  j.estadoAoVivo={
    placarA:parseInt(document.getElementById('placarA').textContent),
    placarB:parseInt(document.getElementById('placarB').textContent),
    tempo:cronoSecs,
    rodando:cronoRunning,
    ultimaAtualizacao:Date.now()
  };
  save(d);
}
function salvarRodada(){
  const d=db(),j=d.jogos.find(x=>x.id===jogoAtual.id);
  // Calcular tempo decorrido (tempo inicial - tempo restante)
  const tempoDecorrido=tempoInicial-cronoSecs;
  j.rodadas.push({timeA:'Time A',timeB:'Time B',golsA:parseInt(document.getElementById('placarA').textContent),golsB:parseInt(document.getElementById('placarB').textContent),tempoSegs:tempoDecorrido});
  save(d);jogoAtual=j;renderResultados();renderClassificacao();
}
function encerrarJogo(){
  apitoFinal();
  cronoRunning=false;clearInterval(cronoTimer);document.getElementById('btnPlay').textContent='‚ñ∂ RETOMAR';
  const gA=parseInt(document.getElementById('placarA').textContent),gB=parseInt(document.getElementById('placarB').textContent);
  if(gA>0||gB>0)salvarRodada();
  alert('üèÅ Jogo encerrado! '+gA+' x '+gB);
  document.getElementById('placarA').textContent='0';
  document.getElementById('placarB').textContent='0';
  cronoSecs=tempoInicial;
  document.getElementById('cronoDisplay').textContent=fmtTime(tempoInicial);
  atualizarObservadores();
}

/* ========== CONTROLE DE TEMPO ========== */
function toggleControle(){
  const el=document.getElementById('tempoControle');
  if(el.style.display==='none'){
    el.style.display='block';
    document.getElementById('btnTempo').classList.add('btn-gold');
  }else{
    el.style.display='none';
    document.getElementById('btnTempo').classList.remove('btn-gold');
  }
}
function ajustarTempo(segundos){
  if(!confirm(`Ajustar tempo em ${segundos>0?'+':''}${segundos} segundos?`))return;
  cronoSecs+=segundos;
  if(cronoSecs<0)cronoSecs=0; // N√£o permitir tempo negativo
  document.getElementById('cronoDisplay').textContent=fmtTime(cronoSecs);
  beep();
  atualizarObservadores();
}
function resetarTempo(){
  if(!confirm('‚ö†Ô∏è Resetar cron√¥metro para '+fmtTime(tempoInicial)+'?\n\nIsso vai voltar ao tempo inicial.'))return;
  cronoSecs=tempoInicial;
  document.getElementById('cronoDisplay').textContent=fmtTime(tempoInicial);
  beep();beep();
  atualizarObservadores();
}
function digitarTempo(){
  const atual=fmtTime(cronoSecs);
  const entrada=prompt('‚å®Ô∏è DIGITAR TEMPO\n\nDigite o tempo no formato MM:SS\nExemplo: 15:30 (15 minutos e 30 segundos)\n\nTempo atual: '+atual,atual);
  
  if(!entrada)return; // Cancelou
  
  // Validar formato MM:SS
  const regex=/^(\d{1,2}):(\d{2})$/;
  if(!regex.test(entrada)){
    alert('‚ùå Formato inv√°lido!\n\nUse: MM:SS\nExemplos: 5:00, 15:30, 45:00');
    return;
  }
  
  const [min,seg]=entrada.split(':').map(n=>parseInt(n));
  
  // Validar valores
  if(seg>=60){
    alert('‚ùå Segundos devem ser entre 00 e 59!');
    return;
  }
  
  const novoTempo=min*60+seg;
  
  if(!confirm(`‚è±Ô∏è Confirmar novo tempo?\n\nDe: ${atual}\nPara: ${fmtTime(novoTempo)}\n\n(${min} minutos e ${seg} segundos)`))return;
  
  cronoSecs=novoTempo;
  document.getElementById('cronoDisplay').textContent=fmtTime(cronoSecs);
  beep();
  atualizarObservadores();
  alert('‚úÖ Tempo atualizado!\n\nNovo tempo: '+fmtTime(cronoSecs));
}

/* ========== ESCOLHA DE MODALIDADE ========== */
function escolherModalidade(modal){
  const u=me();
  const d=db();
  const usuario=d.usuarios.find(x=>x.id===u.id);
  
  const nomes={
    'campo':'Futebol de Campo ‚öΩ',
    'society':'Society ü•Ö',
    'futsal':'Futsal/Sal√£o üèüÔ∏è',
    'x1':'X1 üë§',
    'futevolei':'Futev√¥lei üèê',
    'areia':'Futebol de Areia üèñÔ∏è'
  };
  
  usuario.modalidadeFavorita=modal;
  save(d);
  
  alert(`‚úÖ Modalidade escolhida!\n\n${nomes[modal]}\n\nVoc√™ pode mudar isso depois no seu perfil.`);
  nav('dashboard');
}
function pularModalidade(){
  if(confirm('Tem certeza que quer pular?\n\nVoc√™ pode escolher sua modalidade favorita depois.')){
    nav('dashboard');
  }
}

/* ========== ADMIN ========== */
function acessarAdmin(){
  const senha=prompt('üîê ACESSO RESTRITO - ADMINISTRADOR\n\nDigite a senha de administrador:','');
  
  // Senha padr√£o: admin123
  if(senha==='admin123'){
    alert('‚úÖ Acesso autorizado!\n\nBem-vindo ao painel de administrador.');
    nav('admin');
    carregarAdmin();
  }else if(senha){
    alert('‚ùå Senha incorreta!\n\nAcesso negado.');
  }
}

function carregarAdmin(){
  const d=db();
  
  // Estat√≠sticas gerais
  document.getElementById('adminTotalUsers').textContent=d.usuarios.length;
  document.getElementById('adminOnlineUsers').textContent=d.usuarios.filter(u=>u.online).length;
  document.getElementById('adminTotalJogos').textContent=d.jogos.length;
  document.getElementById('adminTotalTimes').textContent=d.times.length;
  
  const pagantes=d.usuarios.filter(u=>u.plano!=='free').length;
  document.getElementById('adminPagantes').textContent=pagantes;
  
  // Calcular receita mensal
  const receita=d.usuarios.reduce((acc,u)=>{
    if(u.plano==='iniciante')return acc+19.90;
    if(u.plano==='profissional')return acc+39.90;
    return acc;
  },0);
  document.getElementById('adminReceita').textContent='R$ '+receita.toFixed(2);
  
  // √öltimos cadastros (5 mais recentes)
  const ultimos=d.usuarios.slice(-5).reverse();
  document.getElementById('adminUltimosUsers').innerHTML=ultimos.length?
    ultimos.map(u=>`<div style="padding:10px;background:rgba(16,185,129,0.1);border-radius:8px;margin-bottom:8px">
      <strong>${u.nome}</strong> - ${u.email}<br>
      <small style="color:#94a3b8">Plano: ${u.plano.toUpperCase()} | Cadastro: ${fmtDate(u.criadoEm)}</small>
    </div>`).join(''):
    '<p style="color:#64748b">Nenhum usu√°rio cadastrado ainda</p>';
  
  // Jogos ativos (√∫ltimos 5)
  const jogosAtivos=d.jogos.slice(-5).reverse();
  document.getElementById('adminJogosAtivos').innerHTML=jogosAtivos.length?
    jogosAtivos.map(j=>`<div style="padding:10px;background:rgba(245,158,11,0.1);border-radius:8px;margin-bottom:8px">
      <strong>${j.nome}</strong> - ${j.tipo.toUpperCase()}<br>
      <small style="color:#94a3b8">Local: ${j.local} | ${j.rodadas.length} rodadas</small>
    </div>`).join(''):
    '<p style="color:#64748b">Nenhum jogo criado ainda</p>';
}

function adminVerUsuarios(){
  const d=db();
  let info='üë• TODOS OS USU√ÅRIOS ('+d.usuarios.length+' total)\n\n';
  d.usuarios.forEach((u,i)=>{
    info+=`${i+1}. ${u.nome}\n`;
    info+=`   Email: ${u.email}\n`;
    info+=`   Plano: ${u.plano.toUpperCase()}\n`;
    info+=`   Online: ${u.online?'üü¢ SIM':'‚ö™ N√ÉO'}\n\n`;
  });
  alert(info);
}

function adminVerJogos(){
  const d=db();
  let info='‚öΩ TODOS OS JOGOS ('+d.jogos.length+' total)\n\n';
  d.jogos.forEach((j,i)=>{
    info+=`${i+1}. ${j.nome}\n`;
    info+=`   Tipo: ${j.tipo.toUpperCase()}\n`;
    info+=`   Local: ${j.local}\n`;
    info+=`   Rodadas: ${j.rodadas.length}\n\n`;
  });
  alert(info||'Nenhum jogo criado ainda.');
}

function adminVerTimes(){
  const d=db();
  let info='üéΩ TODOS OS TIMES ('+d.times.length+' total)\n\n';
  d.times.forEach((t,i)=>{
    info+=`${i+1}. ${t.nome}\n`;
    info+=`   Jogadores: ${t.jogadores.length}\n`;
    info+=`   Regi√£o: ${t.bairro}, ${t.municipio}\n\n`;
  });
  alert(info||'Nenhum time criado ainda.');
}

function adminLimparDados(){
  if(!confirm('‚ö†Ô∏è ATEN√á√ÉO!\n\nIsso vai APAGAR TODOS OS DADOS do sistema:\n- Usu√°rios\n- Jogos\n- Times\n- Eventos\n\nEssa a√ß√£o N√ÉO PODE ser desfeita!\n\nTem certeza absoluta?'))return;
  
  if(prompt('Digite "CONFIRMAR" para prosseguir:','')!=='CONFIRMAR'){
    alert('‚ùå Cancelado.');
    return;
  }
  
  const d={usuarios:[],jogos:[],times:[],eventos:[],logado:null};
  localStorage.setItem(KEY,JSON.stringify(d));
  alert('‚úÖ Todos os dados foram apagados!\n\nRedirecionando para tela de login...');
  location.reload();
}

function adminExportarDados(){
  const d=db();
  const json=JSON.stringify(d,null,2);
  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='organize-backup-'+Date.now()+'.json';
  a.click();
  alert('‚úÖ Dados exportados com sucesso!\n\nArquivo JSON salvo.');
}

function adminGerarRelatorio(){
  const d=db();
  let rel='üìä RELAT√ìRIO DO SISTEMA ORGANIZE TIMES\n';
  rel+='Data: '+new Date().toLocaleString('pt-BR')+'\n\n';
  rel+='‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
  rel+=`üë• USU√ÅRIOS\n`;
  rel+=`Total: ${d.usuarios.length}\n`;
  rel+=`Online: ${d.usuarios.filter(u=>u.online).length}\n`;
  rel+=`Plano Free: ${d.usuarios.filter(u=>u.plano==='free').length}\n`;
  rel+=`Plano Iniciante: ${d.usuarios.filter(u=>u.plano==='iniciante').length}\n`;
  rel+=`Plano Profissional: ${d.usuarios.filter(u=>u.plano==='profissional').length}\n\n`;
  
  rel+=`‚öΩ JOGOS\n`;
  rel+=`Total: ${d.jogos.length}\n`;
  rel+=`Rachas: ${d.jogos.filter(j=>j.tipo==='racha').length}\n`;
  rel+=`Torneios: ${d.jogos.filter(j=>j.tipo==='torneio').length}\n`;
  rel+=`Campeonatos: ${d.jogos.filter(j=>j.tipo==='campeonato').length}\n\n`;
  
  rel+=`üéΩ TIMES\n`;
  rel+=`Total: ${d.times.length}\n\n`;
  
  const receita=d.usuarios.reduce((acc,u)=>{
    if(u.plano==='iniciante')return acc+19.90;
    if(u.plano==='profissional')return acc+39.90;
    return acc;
  },0);
  
  rel+=`üí∞ RECEITA\n`;
  rel+=`Mensal: R$ ${receita.toFixed(2)}\n`;
  rel+=`Anual: R$ ${(receita*12).toFixed(2)}\n\n`;
  rel+='‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  
  alert(rel);
}

function adminCriarUsuarioTeste(){
  const d=db();
  const num=d.usuarios.length+1;
  const u={
    id:Date.now(),
    nome:'Usu√°rio Teste '+num,
    dataNascimento:'1990-01-01',
    telefone:'(11) 99999-'+String(num).padStart(4,'0'),
    email:'teste'+num+'@organize.com',
    senha:'123456',
    online:Math.random()>0.5,
    ultimoAcesso:Date.now(),
    plano:['free','iniciante','profissional'][Math.floor(Math.random()*3)],
    criadoEm:Date.now()
  };
  d.usuarios.push(u);
  save(d);
  alert('‚úÖ Usu√°rio teste criado!\n\nNome: '+u.nome+'\nEmail: '+u.email+'\nPlano: '+u.plano.toUpperCase());
  carregarAdmin();
}

function adminCriarJogoTeste(){
  const d=db();
  const num=d.jogos.length+1;
  const j={
    id:Date.now(),
    orgId:d.usuarios[0]?.id||1,
    criadorId:d.usuarios[0]?.id||1,
    nome:'Racha Teste '+num,
    tipo:'racha',
    data:new Date().toISOString(),
    local:'Campo Teste '+num,
    modalidade:'5',
    regra:'10min',
    status:'agendado',
    rodadas:[],
    votos:[],
    jogadores:[]
  };
  d.jogos.push(j);
  save(d);
  alert('‚úÖ Jogo teste criado!\n\nNome: '+j.nome+'\nLocal: '+j.local);
  carregarAdmin();
}

function adminSimularTrafego(){
  const qtd=parseInt(prompt('Quantos usu√°rios criar?\n(Recomendado: 10-50)','20'));
  if(!qtd||qtd<1)return;
  
  const d=db();
  for(let i=0;i<qtd;i++){
    const num=d.usuarios.length+1;
    d.usuarios.push({
      id:Date.now()+i,
      nome:'Jogador '+num,
      dataNascimento:'1990-01-01',
      telefone:'(11) 9'+String(num).padStart(8,'0'),
      email:'jogador'+num+'@organize.com',
      senha:'123456',
      online:Math.random()>0.7,
      ultimoAcesso:Date.now()-(Math.random()*86400000),
      plano:Math.random()>0.7?'free':Math.random()>0.5?'iniciante':'profissional',
      criadoEm:Date.now()-(Math.random()*2592000000)
    });
  }
  save(d);
  alert(`‚úÖ Tr√°fego simulado!\n\n${qtd} usu√°rios criados com sucesso.`);
  carregarAdmin();
}

function adminVerConsole(){
  alert('üñ•Ô∏è CONSOLE DE DESENVOLVIMENTO\n\nAbra o Console do navegador:\n\nChrome/Edge: F12 ou Ctrl+Shift+I\nFirefox: F12 ou Ctrl+Shift+K\nSafari: Cmd+Option+I\n\nDigite "db()" para ver todos os dados.\nDigite "me()" para ver usu√°rio logado.');
}

/* ========== TABS ========== */
function trocarTab(q){
  // Fun√ß√£o desativada - pain√©is agora s√£o p√°ginas separadas
  // Use os bot√µes: VER RESULTADOS, VER CLASSIFICA√á√ÉO, VOTAR MVP
  return;
}
function renderResultados(){
  // Renderiza√ß√£o movida para p√°ginas separadas
  return;
}
function renderClassificacao(){
  // Renderiza√ß√£o movida para p√°ginas separadas
  return;
}
function renderVotacao(){
  // Renderiza√ß√£o movida para p√°ginas separadas
  return;
}

/* ========== BEEP ========== */
function beep(){try{const c=new(window.AudioContext||window.webkitAudioContext)();const o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.type='sine';o.frequency.setValueAtTime(880,c.currentTime);g.gain.setValueAtTime(0.4,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+0.3);o.start(c.currentTime);o.stop(c.currentTime+0.3)}catch(e){}}

/* ========== UTILS ========== */
function fmtDate(s){try{return new Date(s).toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'})}catch(e){return s}}
function fmtTime(s){const m=Math.floor(s/60),sec=s%60;return String(m).padStart(2,'0')+':'+String(sec).padStart(2,'0')}

/* ========== SISTEMA DE CHAT/MENSAGENS ========== */
let conversaAtual=null;

// Inicializar banco de mensagens
function initMensagens(){
  const d=db();
  if(!d.mensagens)d.mensagens=[];
  if(!d.conversas)d.conversas=[];
  save(d);
}

// Carregar lista de conversas
function carregarMensagens(){
  initMensagens();
  const d=db();
  const u=me();
  
  // Criar conversas √∫nicas
  const conversasMap=new Map();
  
  d.mensagens.forEach(msg=>{
    const outroId=msg.de===u.id?msg.para:msg.de;
    if(!conversasMap.has(outroId)){
      const outro=d.usuarios.find(x=>x.id===outroId);
      if(outro){
        conversasMap.set(outroId,{
          usuario:outro,
          ultimaMsg:msg,
          naoLidas:0
        });
      }
    }
  });
  
  // Contar n√£o lidas
  conversasMap.forEach((conv,outroId)=>{
    conv.naoLidas=d.mensagens.filter(m=>m.para===u.id&&m.de===outroId&&!m.lida).length;
  });
  
  const conversas=Array.from(conversasMap.values())
    .sort((a,b)=>b.ultimaMsg.timestamp-a.ultimaMsg.timestamp);
  
  renderConversas(conversas);
  atualizarBadgeMensagens();
}

function renderConversas(conversas){
  const el=document.getElementById('listaConversas');
  
  if(conversas.length===0){
    el.innerHTML='<div style="text-align:center;padding:60px 20px;color:#64748b"><div style="font-size:64px;margin-bottom:16px">üí¨</div><p style="font-size:16px;font-weight:600">Nenhuma conversa ainda</p><p style="font-size:14px;margin-top:8px">Envie convites de jogos para iniciar conversas!</p></div>';
    return;
  }
  
  let html='';
  conversas.forEach(c=>{
    const ini=c.usuario.nome.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
    const preview=c.ultimaMsg.tipo==='convite'?'üì¢ '+c.ultimaMsg.texto:c.ultimaMsg.texto;
    const hora=formatHora(c.ultimaMsg.timestamp);
    const naoLida=c.naoLidas>0?'nao-lida':'';
    
    html+=`
      <div class="conversa-item ${naoLida}" onclick="abrirChat(${c.usuario.id})">
        <div class="conversa-avatar">${ini}</div>
        <div class="conversa-info">
          <div class="conversa-nome">
            <span>${c.usuario.nome}</span>
            <span class="conversa-hora">${hora}</span>
          </div>
          <div class="conversa-preview">${preview}</div>
        </div>
        ${c.naoLidas>0?`<div class="conversa-badge">${c.naoLidas}</div>`:''}
      </div>
    `;
  });
  
  el.innerHTML=html;
}

function filtrarConversas(){
  const busca=document.getElementById('buscaConversa').value.toLowerCase();
  const items=document.querySelectorAll('.conversa-item');
  
  items.forEach(item=>{
    const nome=item.querySelector('.conversa-nome span').textContent.toLowerCase();
    if(nome.includes(busca)){
      item.style.display='flex';
    }else{
      item.style.display='none';
    }
  });
}

// Abrir chat individual
function abrirChat(outroUserId){
  const d=db();
  const u=me();
  const outro=d.usuarios.find(x=>x.id===outroUserId);
  
  if(!outro)return;
  
  conversaAtual=outroUserId;
  
  // Marcar mensagens como lidas
  d.mensagens.forEach(m=>{
    if(m.de===outroUserId&&m.para===u.id)m.lida=true;
  });
  save(d);
  
  // Header do chat
  const ini=outro.nome.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
  document.getElementById('chatAvatar').textContent=ini;
  document.getElementById('chatNome').textContent=outro.nome;
  
  const status=outro.online?'<span class="status-online"></span>Online':'Offline';
  document.getElementById('chatStatus').innerHTML=status;
  
  // Carregar mensagens
  carregarMensagensChat();
  
  nav('chat');
  atualizarBadgeMensagens();
}

function carregarMensagensChat(){
  const d=db();
  const u=me();
  
  const mensagens=d.mensagens
    .filter(m=>(m.de===u.id&&m.para===conversaAtual)||(m.de===conversaAtual&&m.para===u.id))
    .sort((a,b)=>a.timestamp-b.timestamp);
  
  renderMensagensChat(mensagens);
  
  // Scroll pro final
  setTimeout(()=>{
    const container=document.getElementById('chatMensagens');
    container.scrollTop=container.scrollHeight;
  },100);
}

function renderMensagensChat(mensagens){
  const u=me();
  const el=document.getElementById('chatMensagens');
  
  if(mensagens.length===0){
    el.innerHTML='<div style="text-align:center;color:#64748b;margin:auto"><p>Nenhuma mensagem ainda</p><p style="font-size:12px;margin-top:8px">Envie a primeira mensagem!</p></div>';
    return;
  }
  
  let html='';
  mensagens.forEach(m=>{
    const enviada=m.de===u.id;
    const classe=enviada?'msg-enviada':'msg-recebida';
    const hora=new Date(m.timestamp).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
    const statusIcon=m.lida?'‚úì‚úì':'‚úì';
    
    if(m.tipo==='convite'){
      html+=renderConviteMsg(m);
    }else{
      html+=`
        <div class="msg-bubble ${classe}">
          <div>${m.texto}</div>
          <div class="msg-hora">
            ${hora}
            ${enviada?`<span class="msg-status">${statusIcon}</span>`:''}
          </div>
        </div>
      `;
    }
  });
  
  el.innerHTML=html;
}

function renderConviteMsg(msg){
  const enviada=msg.de===me().id;
  const hora=new Date(msg.timestamp).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
  
  let html=`
    <div class="msg-convite" style="${enviada?'align-self:flex-end':'align-self:flex-start'}">
      <h4>üì¢ Convite para Jogo</h4>
      <p>${msg.texto}</p>
  `;
  
  if(msg.dados){
    html+=`
      <p style="font-size:13px;color:#cbd5e1;margin-bottom:12px">
        üìÖ ${msg.dados.data}<br>
        üìç ${msg.dados.local}<br>
        ‚öΩ ${msg.dados.modalidade}
      </p>
    `;
  }
  
  if(!enviada&&msg.status==='pendente'){
    html+=`
      <div class="msg-convite-btns">
        <button class="btn-aceitar" onclick="responderConvite(${msg.id},true)">‚úÖ Aceitar</button>
        <button class="btn-recusar" onclick="responderConvite(${msg.id},false)">‚ùå Recusar</button>
      </div>
    `;
  }else if(msg.status==='aceito'){
    html+=`<p style="color:#10b981;font-weight:700;text-align:center">‚úÖ Convite aceito!</p>`;
  }else if(msg.status==='recusado'){
    html+=`<p style="color:#f87171;font-weight:700;text-align:center">‚ùå Convite recusado</p>`;
  }
  
  html+=`
      <div style="text-align:right;margin-top:8px;font-size:11px;color:#64748b">${hora}</div>
    </div>
  `;
  
  return html;
}

function enviarMensagem(){
  const input=document.getElementById('inputMensagem');
  const texto=input.value.trim();
  
  if(!texto||!conversaAtual)return;
  
  const d=db();
  const u=me();
  
  d.mensagens.push({
    id:Date.now(),
    de:u.id,
    para:conversaAtual,
    texto:texto,
    tipo:'texto',
    timestamp:Date.now(),
    lida:false
  });
  
  save(d);
  input.value='';
  carregarMensagensChat();
}

function responderConvite(msgId,aceito){
  const d=db();
  const msg=d.mensagens.find(m=>m.id===msgId);
  
  if(!msg)return;
  
  msg.status=aceito?'aceito':'recusado';
  save(d);
  
  // Enviar resposta
  const u=me();
  d.mensagens.push({
    id:Date.now(),
    de:u.id,
    para:msg.de,
    texto:aceito?'Aceitei o convite! üéâ':'N√£o poderei ir dessa vez üòî',
    tipo:'texto',
    timestamp:Date.now(),
    lida:false
  });
  
  save(d);
  
  alert(aceito?'‚úÖ Convite aceito!':'‚ùå Convite recusado');
  carregarMensagensChat();
}

// Enviar convite de jogo (integrado ao sistema)
function enviarConviteJogo(jogoId,destinatarioId){
  const d=db();
  const u=me();
  const jogo=d.jogos.find(j=>j.id===jogoId);
  
  if(!jogo)return;
  
  d.mensagens.push({
    id:Date.now(),
    de:u.id,
    para:destinatarioId,
    texto:jogo.nome,
    tipo:'convite',
    status:'pendente',
    dados:{
      jogoId:jogoId,
      data:new Date(jogo.data).toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'}),
      local:jogo.local,
      modalidade:jogo.modalidade+' jogadores'
    },
    timestamp:Date.now(),
    lida:false
  });
  
  save(d);
  alert('‚úÖ Convite enviado por mensagem!');
}

// Atualizar badge de mensagens
function atualizarBadgeMensagens(){
  const d=db();
  const u=me();
  
  const naoLidas=d.mensagens?d.mensagens.filter(m=>m.para===u.id&&!m.lida).length:0;
  
  const badge1=document.getElementById('badgeMensagens');
  const badge2=document.getElementById('badgeMsgNav');
  
  if(naoLidas>0){
    if(badge1){
      badge1.style.display='flex';
      badge1.textContent=naoLidas;
    }
    if(badge2){
      badge2.style.display='block';
      badge2.textContent=naoLidas;
    }
  }else{
    if(badge1)badge1.style.display='none';
    if(badge2)badge2.style.display='none';
  }
}

function formatHora(timestamp){
  const agora=new Date();
  const data=new Date(timestamp);
  const diffDias=Math.floor((agora-data)/(1000*60*60*24));
  
  if(diffDias===0){
    return data.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
  }else if(diffDias===1){
    return 'Ontem';
  }else if(diffDias<7){
    return diffDias+' dias';
  }else{
    return data.toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit'});
  }
}

// Integra√ß√£o: adicionar bot√£o de convite na tela de jogo
function adicionarBotaoConviteJogo(){
  // Esta fun√ß√£o pode ser chamada ao carregar a tela de jogo
  // Para adicionar bot√£o de enviar convites aos jogadores
}

function mostrarConvites(){
  if(!jogoAtual){
    alert('‚ùå Nenhum jogo selecionado!');
    return;
  }
  
  const d=db();
  const u=me();
  const usuarios=d.usuarios.filter(x=>x.id!==u.id);
  
  if(usuarios.length===0){
    alert('‚ùå Nenhum usu√°rio dispon√≠vel para convidar!');
    return;
  }
  
  let html='<div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:10000;display:flex;align-items:center;justify-content:center;padding:20px" onclick="fecharModalConvites()">';
  html+='<div style="max-width:600px;width:100%;background:rgba(30,41,59,0.98);border-radius:16px;padding:24px;border:2px solid rgba(100,116,139,0.3);max-height:85vh;overflow-y:auto" onclick="event.stopPropagation()">';
  html+='<h2 style="margin-bottom:8px;color:#10b981;font-size:24px">üí¨ Enviar Convite</h2>';
  html+='<p style="color:#94a3b8;margin-bottom:20px;font-size:14px">Escolha como enviar o convite: por <strong style="color:#10b981">Chat Interno</strong> ou <strong style="color:#25d366">WhatsApp</strong></p>';
  
  html+='<div style="margin-bottom:20px">';
  usuarios.forEach(user=>{
    const ini=user.nome.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
    const online=user.online?'<span style="color:#10b981;font-size:11px;display:flex;align-items:center;gap:4px"><span style="width:6px;height:6px;background:#10b981;border-radius:50%;display:inline-block"></span>Online</span>':'<span style="color:#64748b;font-size:11px">Offline</span>';
    const telefone=user.telefone?user.telefone:'';
    const temTelefone=telefone?true:false;
    
    html+=`
      <div style="background:rgba(15,23,42,0.6);border:2px solid rgba(100,116,139,0.3);border-radius:12px;padding:16px;margin-bottom:12px;transition:all 0.2s">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
          <div style="width:50px;height:50px;background:linear-gradient(135deg,#10b981,#059669);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;color:#000;flex-shrink:0">${ini}</div>
          <div style="flex:1;min-width:0">
            <div style="font-weight:700;color:#cbd5e1;margin-bottom:4px;font-size:16px">${user.nome}</div>
            <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
              ${online}
              ${temTelefone?`<span style="color:#94a3b8;font-size:11px">üì± ${telefone}</span>`:'<span style="color:#f87171;font-size:11px">üìµ Sem telefone</span>'}
            </div>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <button onclick="enviarConviteChat(${user.id})" style="padding:10px;background:linear-gradient(135deg,#10b981,#059669);border:none;border-radius:8px;color:#000;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;font-size:13px;transition:all 0.2s" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(16,185,129,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
            üí¨ Chat
          </button>
          <button onclick="enviarConviteWhatsApp('${telefone}','${user.nome}')" ${!temTelefone?'disabled':''} style="padding:10px;background:${temTelefone?'linear-gradient(135deg,#25d366,#128c7e)':'rgba(100,116,139,0.2)'};border:none;border-radius:8px;color:${temTelefone?'#fff':'#64748b'};font-weight:700;cursor:${temTelefone?'pointer':'not-allowed'};display:flex;align-items:center;justify-content:center;gap:6px;font-size:13px;transition:all 0.2s;opacity:${temTelefone?'1':'0.5'}" ${temTelefone?`onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(37,211,102,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow=''"`:''}}>
            üì± WhatsApp
          </button>
        </div>
      </div>
    `;
  });
  html+='</div>';
  
  html+='<button onclick="fecharModalConvites()" style="width:100%;padding:14px;background:rgba(100,116,139,0.2);border:2px solid rgba(100,116,139,0.3);border-radius:12px;color:#94a3b8;font-weight:700;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background=\'rgba(100,116,139,0.3)\'" onmouseout="this.style.background=\'rgba(100,116,139,0.2)\'">Cancelar</button>';
  html+='</div></div>';
  
  const modal=document.createElement('div');
  modal.id='modalConvites';
  modal.innerHTML=html;
  document.body.appendChild(modal);
}

function fecharModalConvites(){
  const modal=document.getElementById('modalConvites');
  if(modal)modal.remove();
}

function enviarConviteChat(userId){
  enviarConviteJogo(jogoAtual.id,userId);
  fecharModalConvites();
}

function enviarConviteWhatsApp(telefone,nome){
  if(!telefone){
    alert('‚ùå Este usu√°rio n√£o tem telefone cadastrado!');
    return;
  }
  
  if(!jogoAtual){
    alert('‚ùå Erro ao carregar dados do jogo!');
    return;
  }
  
  // Formatar telefone (remover espa√ßos, par√™nteses, h√≠fens)
  const telLimpo=telefone.replace(/\D/g,'');
  
  // Criar mensagem do convite
  const dataFormatada=new Date(jogoAtual.data).toLocaleString('pt-BR',{
    day:'2-digit',
    month:'2-digit',
    year:'numeric',
    hour:'2-digit',
    minute:'2-digit'
  });
  
  const mensagem=`üéâ *CONVITE PARA JOGO!*

‚öΩ *${jogoAtual.nome}*

üìÖ Data: ${dataFormatada}
üìç Local: ${jogoAtual.local}
üë• Modalidade: ${jogoAtual.modalidade} jogadores

Confirma presen√ßa? üòä`;
  
  // Codificar mensagem para URL
  const mensagemCodificada=encodeURIComponent(mensagem);
  
  // Criar link do WhatsApp
  const linkWhatsApp=`https://wa.me/55${telLimpo}?text=${mensagemCodificada}`;
  
  // Abrir WhatsApp
  window.open(linkWhatsApp,'_blank');
  
  alert(`‚úÖ Abrindo WhatsApp para enviar convite para ${nome}!`);
  fecharModalConvites();
}

function enviarConviteParaUsuario(userId){
  // Fun√ß√£o antiga mantida para compatibilidade
  enviarConviteChat(userId);
}

function gerarLinkConvite(){
  if(!jogoAtual){
    alert('‚ùå Nenhum jogo selecionado!');
    return;
  }
  
  const u=me();
  
  // Gerar link do convite
  const baseUrl=window.location.origin+window.location.pathname.replace('ORGANIZE.html','');
  const linkConvite=`${baseUrl}CONVITE.html?c=${u.id}&t=jogo&jid=${jogoAtual.id}`;
  
  // Criar modal de compartilhamento
  let html='<div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:10000;display:flex;align-items:center;justify-content:center;padding:20px" onclick="fecharModalLinkConvite()">';
  html+='<div style="max-width:600px;width:100%;background:rgba(30,41,59,0.98);border-radius:20px;padding:32px;border:3px solid rgba(99,102,241,0.5);max-height:90vh;overflow-y:auto" onclick="event.stopPropagation()">';
  
  html+='<h2 style="margin-bottom:12px;color:#6366f1;font-size:28px;text-align:center">üîó Convite para Novos Jogadores</h2>';
  html+='<p style="color:#94a3b8;margin-bottom:24px;text-align:center;font-size:14px">Compartilhe este link para convidar pessoas que ainda n√£o tem conta no app!</p>';
  
  // Preview do convite
  html+='<div style="background:rgba(99,102,241,0.1);border:2px solid rgba(99,102,241,0.3);border-radius:16px;padding:24px;margin-bottom:24px;text-align:center">';
  html+='<div style="font-size:48px;margin-bottom:12px">üéâ</div>';
  html+='<div style="font-size:20px;font-weight:700;color:#cbd5e1;margin-bottom:8px">'+u.nome+'</div>';
  html+='<div style="font-size:14px;color:#94a3b8;margin-bottom:12px">convidou voc√™ para</div>';
  html+='<div style="font-size:24px;font-weight:900;color:#fbbf24">‚öΩ '+jogoAtual.nome.toUpperCase()+'</div>';
  html+='</div>';
  
  // Link - vers√£o clic√°vel e compacta
  html+='<div style="margin-bottom:20px">';
  html+='<label style="display:block;margin-bottom:12px;color:#cbd5e1;font-weight:600;font-size:14px;text-align:center">üìé Seu Link de Convite:</label>';
  
  // Box do link clic√°vel
  html+='<div style="background:rgba(99,102,241,0.15);border:2px solid rgba(99,102,241,0.4);border-radius:16px;padding:20px;margin-bottom:16px;text-align:center">';
  html+='<a href="'+linkConvite+'" target="_blank" id="linkConviteVisivel" style="display:inline-block;color:#818cf8;font-size:14px;font-weight:700;text-decoration:underline;word-break:break-all;line-height:1.5;transition:all 0.2s" onmouseover="this.style.color=\'#a5b4fc\';this.style.transform=\'scale(1.02)\'" onmouseout="this.style.color=\'#818cf8\';this.style.transform=\'scale(1)\'">üîó '+linkConvite+'</a>';
  html+='<div style="font-size:12px;color:#6366f1;margin-top:12px;font-weight:600">üëÜ Clique para testar</div>';
  html+='</div>';
  
  // Input oculto para fun√ß√£o de copiar
  html+='<input type="text" id="linkConviteInput" value="'+linkConvite+'" style="position:absolute;left:-9999px;opacity:0">';
  
  // Bot√£o grande de copiar
  html+='<button onclick="copiarLinkConvite()" style="width:100%;padding:16px;background:linear-gradient(135deg,#10b981,#059669);border:none;border-radius:14px;color:#000;font-weight:800;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.3s;box-shadow:0 4px 12px rgba(16,185,129,0.3)" onmouseover="this.style.transform=\'translateY(-3px)\';this.style.boxShadow=\'0 8px 24px rgba(16,185,129,0.5)\'" onmouseout="this.style.transform=\'\';this.style.boxShadow=\'0 4px 12px rgba(16,185,129,0.3)\'">
    <span style="font-size:24px">üìã</span>
    <span>COPIAR LINK DO CONVITE</span>
  </button>';
  html+='</div>';
  
  // Separador
  html+='<div style="text-align:center;margin:24px 0;color:#64748b;font-size:13px;font-weight:600">ou compartilhe direto</div>';
  
  // Op√ß√µes de compartilhamento
  html+='<div style="margin-bottom:20px">';
  html+='<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">';
  
  const mensagemWhatsApp=`üéâ *Voc√™ foi convidado!*\n\n${u.nome} te convidou para participar do jogo:\n‚öΩ *${jogoAtual.nome}*\n\nClique no link e fa√ßa seu cadastro:\n${linkConvite}`;
  const whatsappLink=`https://api.whatsapp.com/send?text=${encodeURIComponent(mensagemWhatsApp)}`;
  
  html+=`<button onclick="window.open('${whatsappLink}','_blank')" style="padding:16px 12px;background:linear-gradient(135deg,#25d366,#128c7e);border:none;border-radius:12px;color:#fff;font-weight:700;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;transition:all 0.2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 6px 16px rgba(37,211,102,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
    <span style="font-size:28px">üì±</span>
    <span style="font-size:13px">WhatsApp</span>
  </button>`;
  
  const telegramLink=`https://t.me/share/url?url=${encodeURIComponent(linkConvite)}&text=${encodeURIComponent('üéâ Voc√™ foi convidado! '+u.nome+' te convidou para '+jogoAtual.nome)}`;
  
  html+=`<button onclick="window.open('${telegramLink}','_blank')" style="padding:16px 12px;background:linear-gradient(135deg,#0088cc,#006699);border:none;border-radius:12px;color:#fff;font-weight:700;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;transition:all 0.2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 6px 16px rgba(0,136,204,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
    <span style="font-size:28px">‚úàÔ∏è</span>
    <span style="font-size:13px">Telegram</span>
  </button>`;
  
  html+=`<button onclick="compartilharNativo('${linkConvite}','${jogoAtual.nome}','${u.nome}')" style="padding:16px 12px;background:linear-gradient(135deg,#6366f1,#4f46e5);border:none;border-radius:12px;color:#fff;font-weight:700;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;transition:all 0.2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 6px 16px rgba(99,102,241,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
    <span style="font-size:28px">üì§</span>
    <span style="font-size:13px">Mais</span>
  </button>`;
  
  html+='</div></div>';
  
  // Instru√ß√µes
  html+='<div style="background:rgba(16,185,129,0.1);border:2px solid rgba(16,185,129,0.2);border-radius:12px;padding:16px;margin-bottom:20px">';
  html+='<div style="font-size:14px;color:#6ee7b7;font-weight:600;margin-bottom:8px">‚ú® Como funciona:</div>';
  html+='<div style="font-size:13px;color:#94a3b8;line-height:1.6">';
  html+='1. Compartilhe o link com quem voc√™ quer convidar<br>';
  html+='2. A pessoa clica no link<br>';
  html+='3. V√™ um convite personalizado com seu nome<br>';
  html+='4. Clica em "ACEITAR E CADASTRAR"<br>';
  html+='5. Faz o cadastro no app<br>';
  html+='6. Entra automaticamente no jogo!';
  html+='</div></div>';
  
  html+='<button onclick="fecharModalLinkConvite()" style="width:100%;padding:14px;background:rgba(100,116,139,0.2);border:2px solid rgba(100,116,139,0.3);border-radius:12px;color:#94a3b8;font-weight:700;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background=\'rgba(100,116,139,0.3)\'" onmouseout="this.style.background=\'rgba(100,116,139,0.2)\'">Fechar</button>';
  
  html+='</div></div>';
  
  const modal=document.createElement('div');
  modal.id='modalLinkConvite';
  modal.innerHTML=html;
  document.body.appendChild(modal);
}

function fecharModalLinkConvite(){
  const modal=document.getElementById('modalLinkConvite');
  if(modal)modal.remove();
}

function copiarLinkConvite(){
  const input=document.getElementById('linkConviteInput');
  input.select();
  input.setSelectionRange(0,99999);
  
  try{
    document.execCommand('copy');
    alert('‚úÖ Link copiado!\n\nAgora voc√™ pode colar em qualquer lugar.');
  }catch(err){
    // Fallback para navegadores modernos
    navigator.clipboard.writeText(input.value).then(()=>{
      alert('‚úÖ Link copiado!\n\nAgora voc√™ pode colar em qualquer lugar.');
    }).catch(()=>{
      alert('‚ùå Erro ao copiar. Selecione e copie manualmente (Ctrl+C)');
    });
  }
}

function compartilharNativo(link,nomeJogo,nomeConvidante){
  const texto=`üéâ Voc√™ foi convidado!\n\n${nomeConvidante} te convidou para ${nomeJogo}\n\nClique e fa√ßa seu cadastro:`;
  
  if(navigator.share){
    navigator.share({
      title:'Convite - ORGANIZE TIMES',
      text:texto,
      url:link
    }).then(()=>{
      console.log('Compartilhado com sucesso');
    }).catch((err)=>{
      console.log('Erro ao compartilhar:',err);
    });
  }else{
    copiarLinkConvite();
  }
}

/* ========== INIT ========== */
// Fun√ß√£o de debug - listar usu√°rios
window.listarUsuarios=function(){
  const d=db();
  console.log('=== USU√ÅRIOS CADASTRADOS ===');
  console.log('Total:', d.usuarios.length);
  d.usuarios.forEach((u,i)=>{
    console.log(`${i+1}. ${u.nome}`);
    console.log(`   Email: ${u.email}`);
    console.log(`   Senha: ${u.senha}`);
    console.log(`   Plano: ${u.plano||'free'}`);
    console.log('---');
  });
  return d.usuarios;
};

window.onload=function(){
  const d=db();
  const urlParams=new URLSearchParams(window.location.search);
  const isLoginRequest=urlParams.get('login');
  
  if(d.logado){
    const u=d.usuarios.find(x=>x.id===d.logado);
    if(u){u.online=true;u.ultimoAcesso=Date.now();save(d)}
    initMensagens();
    atualizarBadgeMensagens();
    nav('dashboard');
  }else{
    document.getElementById('tela-login').style.display='flex';
    
    // Se veio de convite para login, abrir bloco de login
    if(isLoginRequest==='1'){
      document.getElementById('bloco-registro').style.display='none';
      document.getElementById('bloco-login').style.display='block';
      // Mostrar mensagem informativa
      setTimeout(()=>{
        const alert=document.getElementById('alert-login2');
        if(alert){
          alert.innerHTML='<div class="alert" style="background:rgba(99,102,241,0.1);border-color:rgba(99,102,241,0.3);color:#a5b4fc"><strong>üîë Fa√ßa login</strong> para aceitar o convite e entrar no jogo!</div>';
        }
      },300);
    }
  }
  
  // M√°scara de data de nascimento aprimorada
  const inputData=document.getElementById('regDataNasc');
  inputData.addEventListener('input',function(e){
    let v=e.target.value.replace(/\D/g,''); // Remove n√£o-n√∫meros
    
    // Adiciona as barras automaticamente
    if(v.length>=2){
      v=v.slice(0,2)+'/'+v.slice(2);
    }
    if(v.length>=5){
      v=v.slice(0,5)+'/'+v.slice(5,9);
    }
    
    e.target.value=v;
  });
  
  // Adicionar placeholder visual
  inputData.setAttribute('placeholder','DD/MM/AAAA');
  
  // M√°scara de telefone
  const inputTel=document.getElementById('regTel');
  inputTel.addEventListener('input',function(e){
    let v=e.target.value.replace(/\D/g,''); // Remove n√£o-n√∫meros
    
    // Formato: (XX) XXXXX-XXXX
    if(v.length>=1){
      v='('+v;
    }
    if(v.length>=3){
      v=v.slice(0,3)+') '+v.slice(3);
    }
    if(v.length>=10){
      v=v.slice(0,10)+'-'+v.slice(10,14);
    }
    
    e.target.value=v.slice(0,15); // Limita tamanho
  });
  
  // Atualizar badge de mensagens a cada 5 segundos
  setInterval(()=>{
    if(db().logado)atualizarBadgeMensagens();
  },5000);
};
setInterval(()=>{const d=db();if(!d.logado)return;const u=d.usuarios.find(x=>x.id===d.logado);if(u){u.online=true;u.ultimoAcesso=Date.now();save(d)}},30000);
</script>
</body>
</html>
